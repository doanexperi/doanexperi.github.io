<!--20230302 modify according to YW and HLS-->
<!DOCTYPE html>
<html>

<head>
    <title>Judgment and Prediction</title>
    <script src="dist/jspsych.js"></script>
    <script src="dist/plugin-fullscreen.js"></script>
    <script src="dist/plugin-image-keyboard-response.js"></script>
    <script src="dist/plugin-preload.js"></script>
    <script src="dist/plugin-survey-text.js"></script>
    <script src="dist/plugin-html-button-response.js"></script>
    <script src="dist/plugin-survey-likert.js"></script>
    <script src="dist/plugin-html-keyboard-response.js"></script>
    <script src="dist/plugin-survey-html-form.js"></script>
    <script src="dist/plugin-image-button-response.js"></script>
    <script src="dist/plugin-survey.js"></script>
    <script src="dist/plugin-survey-multi-select.js"></script>
    <script src="dist/plugin-call-function.js"></script>
    <script src="test_sales_stimuli.js"></script>
    <script src="dist/plugin-external-html.js"></script>
    <link rel="stylesheet" href="dist/jspsych.css">
    <link rel="stylesheet" href="dist/survey.css">
    <link rel="stylesheet" href="./test_2.css">
</head>

<body>
</body>

<script type="text/javascript">
    /* Global Variables */
    var timeline = [];

    const btn_html_timer =
        `<style onload="tid=setInterval(timer, 1000)"></style>
     <button onclick="clearInterval(tid)" class="jspsych-btn" disabled=true>%choice%</button>`

    pause_time = [{
        time_gap: 5
    }, {
        time_gap: 10
    }, {
        time_gap: 15
    }, {
        time_gap: 20
    }]


    //在实验开始前按照时间顺序取出对应的数据集。分别是10个，5个，5个,5个。
    //首先得到25个index。一共是66个。
    var stimulus_index = []
    for (var i = 0; i < 25; i++) {
        var index = Math.floor(Math.random() * 60)
        if (-1 == stimulus_index.indexOf(index)) {
            stimulus_index.push(index)
        } else {
            i = i - 1
        }
    }

    var index_list_prac1 = stimulus_index.slice(0, 3)
    var index_list_prac2 = stimulus_index.slice(3, 10)
    var index_list_part1 = stimulus_index.slice(10, 15)
    var index_list_part2 = stimulus_index.slice(15, 20)
    var index_list_part3 = stimulus_index.slice(20, 25)
        //var index_list_part2_free = stimulus_index.slice(15, 19)
        //var index_list_part2_pay = stimulus_index.slice(19)

    var prac_samples_3 = []
    var prac_samples_7 = []
    var exp_sales_stimuli_part1 = []
    var exp_sales_stimuli_part2 = []
    var exp_sales_stimuli_part3 = []

    for (var index of index_list_prac1) {
        prac_samples_3.push(stimuli_samples[index])
    }

    for (var index of index_list_prac2) {
        prac_samples_7.push(stimuli_samples[index])
    }

    for (var index of index_list_part1) {
        exp_sales_stimuli_part1.push(stimuli_samples[index])
    }

    for (var index of index_list_part2) {
        exp_sales_stimuli_part2.push(stimuli_samples[index])
    }

    for (var index of index_list_part3) {
        exp_sales_stimuli_part3.push(stimuli_samples[index])
    }


    var conditional_web = Math.floor(Math.random() * 3)
        //var conditional_web = 2


    var scale = ["完全没有信心", "没有信心", "有点没有信心", "不确定", "有点信心", "有信心", "非常有信心"];


    var jsPsych = initJsPsych({
        default_ITI: 250,
        on_finish: function() {
            var date = new Date()
            var year = date.getFullYear()
            var month = date.getMonth() + 1
            var date1 = date.getDate()
            var hour = date.getHours()
            var minute = date.getMinutes()
            var seconds = date.getSeconds()
            var file_name_csv = "exp_data_" + year.toString() + '-' + month.toString() + '-' + date1.toString() + '-' + hour.toString() + '-' + minute.toString() + '-' + seconds.toString() + '.csv'
            var file_name_json = "exp_data_" + year.toString() + '-' + month.toString() + '-' + date1.toString() + '-' + hour.toString() + '-' + minute.toString() + '-' + seconds.toString() + '.json'
            jsPsych.data.displayData();
            jsPsych.data.get().localSave('csv', file_name_csv);
            jsPsych.data.get().localSave('json', file_name_json);
            document.getElementById('jspsych-content').innerHTML += `<p class='context' style='font-size:1.375rem /* 22/16 */; text-align=center'>实验结束，感谢你的参与！</p>`
        }
    });

    var set_html_style = {
        type: jsPsychCallFunction,
        func: function() {
            //document.body.style.backgroundColor = 'rgb(250, 250, 250)' // background color
            document.body.style.backgroundColor = 'rgb(250, 250, 250)' // background color
            document.body.style.color = 'black' // font color
                //document.body.style.fontSize = '20pt'
                //document.body.style.fontFamily = '微软雅黑'
                //document.body.style.fontWeight = 'bold' // 'normal', 'bold'
            document.body.style.lineHeight = '1.6em' // line space
            document.body.style.cursor = 'default' // 'default', 'none', 'wait', ...
            document.body.onselectstart = function() {
                    return false
                } // 禁止选中文字 <body oncontextmenu="return false">
            document.body.oncontextmenu = function() {
                    return false
                } // 禁用鼠标右键 <body onselectstart="return false">
            document.onkeydown = function() {
                // 屏蔽键盘按键 (https://www.bejson.com/othertools/keycodes/)
                if ((event.keyCode in {
                        27: 'Esc',
                        116: 'F5',
                        123: 'F12'
                    }) ||
                    (event.ctrlKey && event.keyCode in {
                        85: 'U'
                    })
                ) {
                    return false
                }
            }
        },
    }

    var preload = {
        type: jsPsychPreload,
        auto_preload: true
    };

    var exp_open_remarks = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
                    <p style="font: bold 2.3125rem 微软雅黑; color: #B22222"> 判断与预测实验 </p></br>

                    <div style="max-width: 75%; margin:0 atuo; ">
  
                    <p class='context' style='line-height: 1.8em; text-indent:3.125rem'>你好！我们是浙江大学管理学院的研究团队，正在进行一项关于判断与预测行为的研究。实验过程中需要你<font color="red">做出判断并进行预测</font>。我们向您保证期间所有数据和信息的安全。
                    <p class='context' style='line-height: 1.8em; text-indent:3.125rem'>你需要根据提供的信息<font color="red">预测产品销量</font>。
                        <p class='context' style='line-height: 1.8em; text-indent:3.125rem'>整个实验包含<font color="red">1个练习阶段和4个正式决策阶段，以及对应的问卷填写阶段</font>，在每个阶段结束后会进行通知。大概需要花费<b>30-40分钟</b>的时间，完整参与实验的报酬在<font color="red">20-50元</font>之间。
                        <p class='context' style='text-indent:3.125rem'>实验过程中请注意以下事项：
                    <p class='context' style='text-indent:3.125rem /* 50/16 */'>1. 请保证自愿参加本实验，如果中途放弃实验你将失去相关金额。
                    <p class='context' style='text-indent:3.125rem /* 50/16 */'>2. 请仔细阅读接下来的提示信息，<font color="red">你的表现影响你最终的实验报酬</font>。
                    <p class='context' style='text-indent:3.125rem /* 50/16 */'>3. 在实验结束后请按照提示语及时联系实验人员，避免误操丢失数据。
                    </br></br>
                                  
                    <p style='text-align:center;font-family: "微软雅黑"; font-weight:100; font-size:1.15rem'>在了解和同意以上的注意事项后，请点击按钮进入全屏模式并进入实验环节。</p></div>
                                      
                    <p>
                    `,
            button_label: '开始实验',
            delay_after: 100,
        }
        //timeline.push(exp_open_remarks);

    var exp_game_task_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            data: {
                phasename: 'role_intro',
            },
            message: `
            <div style="max-width: 75%; margin:0 atuo; ">
                    <p style="font: bold 22pt 微软雅黑; text-align: left; line-height: 1.8em"> 【实验背景介绍】</p></br></br>
                    <p class='context'>在本实验中，你需要预测<font color="red">蛋糕销量</font>。具体信息如下：</p></br>
                    <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.8em;'>· 请将自己想象成<font color="red">一个烘焙加盟店的店长</font>，需要为自己加盟的烘焙店<font color="red">预测蛋糕销量</font>，以便提前制作好蛋糕。</p>
                    <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.8em;'>· <font color="red">蛋糕销量的精准预测对烘焙店盈利十分重要</font>：预测偏少，失去消费者市场；预测太多，制作的蛋糕由于新鲜度的要求会贬值甚至无法售卖。</p></br>
                    
                    <p class='context' style='line-height: 1.8em; text-indent:3.125rem'>你需要根据有限的信息尽可能准确地预测蛋糕制作数量,<font color="red">预测准确性决定了你的实验收益</font>，因此请仔细阅读所有的相关信息。</p>
                    </br><p>`,
            button_label: '继续',
            delay_after: 100
        }
        //timeline.push(exp_game_task_intro);

    var exp_interest_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
            
                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em">【酬金规则介绍】</p></br>
                    <div class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em; font-size:1.3rem'>
                    本次实验酬金包括<font color="red">基本酬金和浮动酬金</font>：</br>
                    <p> 1. 基本酬金：<font color="red">15</font>元。完整参与实验并认真填写问卷即可获得。</p>
                    <p> 2. 浮动酬金：总的浮动酬金取决于各实验阶段的表现: </p>
                    <p style='text-indent:5rem'> (1) <font color="red">单次预测收益</font>决定了浮动酬金。具体的酬金规则在对应环节详细介绍。</p>
                    <p style='text-indent:5rem'> (2)单次预测收益计算规则：根据预测偏差计算预测收益。</p>
                    <div style='text-indent:6rem /* 50/16 */; line-height: 1.1em; font-size:1.1rem; font-family: "微软雅黑";font-weight:100; '>
                    <p>· <b> 单次预测偏差=|预测值-真实值|/真实值</b>
                    <p>· 偏差为<font color="red">0</font>，单次预测收益<font color="red">5元</font>；
                 
                    <p>· 偏差不超过<font color="red">8%</font>，单次预测收益<font color="red">4元</font>；
                    
                    <p>· 偏差不超过<font color="red">16%</font>，单次预测收益<font color="red">3元</font>；
                    
                    <p>· 偏差不超过<font color="red">24%</font>，单次预测收益<font color="red">2元</font>；
                   
                    <p>· 偏差不超过<font color="red">32%</font>，单次预测收益<font color="red">1元</font>；
                   
                    <p>· 偏差超过<font color="red">32%</font>，单次预测收益<font color="red">0元</font>.
                    </div>
                    <p line-height: 0em> * 最终酬金=基本酬金+浮动酬金。最终酬金在<b><font color="red">20~50元</font></b>之间浮动。</p></div>`,
            button_label: '已了解酬金规则',
            delay_after: 100
        }
        //timeline.push(exp_interest_intro);


    //用弹窗加一个错误的提醒，比如和正确答案一样
    var exp_interest_test = {
            type: jsPsychSurveyHtmlForm,
            data: {
                task: 'exp_interest_test',
                answer1: 1,
                answer2: 3,
                answer3: 5
            },
            preamble: `
            <div style="max-width: 100%; margin:0 atuo; ">

            <p style="font: 1.5rem 微软雅黑; text-align: center; line-height: 1.5em">【酬金计算练习】</p></br>

                    <div class='context' style='text-indent:6rem /* 50/16 */; line-height: 1.5em'>请在3分钟之内计算单次预测收益（计算错误时页面会弹窗提醒，完全正确才能跳转）：
                    <div style='text-indent:6rem /* 50/16 */; line-height: 1.1em; font-size:1.1rem; font-family: "微软雅黑";font-weight:100; '>
                    <p>· <b> 单次预测偏差=|预测值-真实值|/真实值</b>
                    <p>· 偏差为<font color="red">0</font>，单次预测收益<font color="red">5元</font>；
                    <p>· 偏差不超过<font color="red">8%</font>，单次预测收益<font color="red">4元</font>；
                    <p>· 偏差不超过<font color="red">16%</font>，单次预测收益<font color="red">3元</font>；
                    <p>· 偏差不超过<font color="red">24%</font>，单次预测收益<font color="red">2元</font>；
                    <p>· 偏差不超过<font color="red">32%</font>，单次预测收益<font color="red">1元</font>；
                    <p>· 偏差超过<font color="red">32%</font>，单次预测收益<font color="red">0元</font>.
                    </div>`,
            html: `<div class='context' style='text-indent:6rem /* 50/16 */; line-height: 1.5em; font-size:1.3rem'>
                
                <p>1. 你预测需提前制作13个蛋糕，实际市场需求18个蛋糕，单次预测收益 <input type="text" name="profit_calcu1" size="1" required  onchange="if (this.value!=1){alert('计算错误！请重新计算。');this.value='';}"/> 元；
                    <p>2. 你预测需提前制作25个蛋糕，实际市场需求22个蛋糕，单次预测收益 <input type="text" name="profit_calcu2" size="1" required onchange="if (this.value!=3){alert('计算错误！请重新计算。');this.value='';}"/> 元；
                    <p>3. 你预测需提前制作8个蛋糕，实际市场需求8个蛋糕，单次预测收益 <input type="text" name="profit_calcu3" size="1" required onchange="if (this.value!=5){alert('计算错误！请重新计算。');this.value='';}"/> 元。   
                    </div>`,
            button_label: '确认提交',
        }
        //timeline.push(exp_interest_test)

    var fullscreen_open = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        delay_after: 10
    }

    var exp_rule_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            data: {
                phasename: 'varaiables_intro',
            },
            message: `
            <div style="max-width: 100%; margin:0 atuo; ">
                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.2em">【蛋糕销量预测要点】</p></br>
                    <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1em'>
                    你需要根据<font color="red">7项信息预测相应的蛋糕销量</font>并提前制作。7项相关信息的介绍如下：</p>
                    <div style="text-indent:4.375rem /* 70/16 */; font:1.45rem /* 20/16 */ SimSun; line-height: 0.8em; text-align:left">
                    <p>① <font color="red">日期</font>：例如5月27日。在4——5月随机抽取，日期并不会一直连续出现。</p>
                    <p>② <font color="red">星期</font>：周一到周日，与日期匹配。</p>
                    <p>③ <font color="red">前一周平均每天人流量</font>：当前日期前一周每天的平均人流量。</p>
                    <p>④ <font color="red">传单数</font>：为当天准备和制作的烘焙店宣传单数量。</p>
                    <p>⑤ <font color="red">促销</font>：门店是否有促销活动。例如，蛋糕的打折优惠活动。</p>
                    <p>⑥ <font color="red">气温</font>：摄氏度，根据天气预报得到。</p>
                    <p>⑦ <font color="red">天气</font>：根据天气预报得到，包括雨、晴、阴、多云。</p>
                   </div>
                    </br>
                   
                    <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1em'>
                    根据过去年份的销量数据，有以下几点提示：</p>
                    <div style="text-indent:4.375rem /* 70/16 */; font:1.3rem /* 20/16 */ SimSun; line-height: 0.8em; text-align:left"> 
                    <p>· 蛋糕的每天销量存在不同幅度的<font color="red">波动</font>。</p>
                    <p>· 以上提供的7项信息的重要性不同，有的影响很大有的几乎没有影响。</p>
                    <p>· 不要过多考虑真实生活情境中的因素，如外卖配送、线上下单等。</p>
                    <p>· 你可以<font color="red">使用提供的纸和笔</font>帮助自己更好地进行决策。</p>
                    <p>· 实验数据来自kaggle竞赛数据集。</p>                   
                    </div>
                    </br>
                    <p></div>`,
            button_label: '继续',
            delay_after: 100
        }
        //exp_rule_intro)

    /* Blocks: 3 days self-prediction */
    var practice_trial_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em; text-align:center">【预测操作练习阶段】</p></br>
        <div style="font:1.5rem /* 24/16 */ SimSun; line-height: 1.2em; text-align:center">
        <p>· 通过3次预测练习帮助你更好地了解蛋糕预测任务的情况和具体的操作过程。</p>
        <p style='color:red;'>练习阶段的表现不影响最终报酬，但请认真对待！</p>
        </div>
        <p>`,
            button_lable: '进入练习',
            delay_after: 100
        }
        //timeline.push(practice_trial_intro)

    var exp_predict_practice = {
            type: jsPsychSurvey,
            data: {
                taskdate_1: jsPsych.timelineVariable('Date'),
                task: 'exp_practice_per_task'
            },
            pages: [
                [{
                    type: 'html',
                    prompt: function() {
                        var html = `
                    <p style="font: 1.5rem 微软雅黑; text-align: center; line-height: 1.5em;color:Gray; ">蛋糕销量预测</p></br>
                <p class='context' style='line-height: 1.2em'>
                请你根据以下信息预测蛋糕销量(提前制作蛋糕数量）：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.3rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br></br>
                <p class='context' style=' line-height: 1em'>
                请根据提供的7项信息，进行预测：</p>
                `;
                        return html;
                    }
                }, {
                    type: 'text',
                    prompt: '1. 你预计制作多少个蛋糕？',
                    name: 'pred_num_practice',
                    required: true
                }, {
                    type: 'likert',
                    prompt: '2. 你对自己的预测结果有多大信心？',
                    name: 'pred_confi_practice',
                    required: true,
                    likert_scale_min_label: '完全没有信心',
                    likert_scale_max_label: '非常有信心',
                    likert_scale_values: [{
                        value: 1,
                    }, {
                        value: 2
                    }, {
                        value: 3
                    }, {
                        value: 4
                    }, {
                        value: 5
                    }, {
                        value: 6
                    }, {
                        value: 7
                    }]
                }]
            ],
            button_label_finish: '查看真实销量'
        }
        //timeline.push(exp_predict_practice)

    var exp_predict_practice_result_eval = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            task: 'pre_eval',
            turevalue: jsPsych.timelineVariable('Sales'),
        },
        stimulus: function() {
            var self_pre = jsPsych.data.get().filter({
                taskdate_1: jsPsych.timelineVariable('Date')
            }).values()[0]
            var self_pre = eval(JSON.parse(JSON.stringify(self_pre))).response.pred_num_practice
            var ture_sale = jsPsych.timelineVariable('Sales')
            var bias = (Math.abs(self_pre - ture_sale)) / ture_sale
            if (bias == 0) {
                var daily_profit = 10
            } else if (0 < bias <= 0.04) {
                var daily_profit = 9
            } else if (0.04 < bias <= 0.08) {
                var daily_profit = 8
            } else if (0.08 < bias <= 0.12) {
                var daily_profit = 7
            } else if (0.12 < bias <= 0.16) {
                var daily_profit = 6
            } else if (0.16 < bias <= 0.20) {
                var daily_profit = 5
            } else if (0.2 < bias <= 0.24) {
                var daily_profit = 4
            } else if (0.24 < bias <= 0.28) {
                var daily_profit = 3
            } else if (0.28 < bias <= 0.32) {
                var daily_profit = 2
            } else if (0.32 < bias <= 0.36) {
                var daily_profit = 1
            } else {
                var daily_profit = 0
            }
            var bias_percent = bias * 100
            var bias_percent = bias_percent.toFixed(2)
                //修改了每次反馈的内容，不要直观地反馈收益
                //<p>你本次的预测偏差为 <b> ${bias_percent}% </b> </p>
                //<p>你本次的预测收益为 <b> ${daily_profit} </b>元</p>
            return `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【销量预测结果评估】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>实际销量为 ${ture_sale} 个</p>
                            <p>你的预测为 ${self_pre} 个</p>
                            <p>你本次的预测偏差为 <b> ${bias_percent}% </b> </p>
                            </br>
                            <p style='color:Gray;'>（按任意键继续）</p>
                            </div>`
        },
    }

    var exp_pre_pract3 = {
            timeline: [exp_predict_practice, exp_predict_practice_result_eval],
            timeline_variables: prac_samples_3,
            data: {
                phase: 'pre_pract'
            },
        }
        //timeline.push(exp_pre_pract3)

    var exp_pre_pract3_end = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em; text-align:center">【练习阶段结束】</p></br>
        <div style="font:1.5rem /* 24/16 */ SimSun; line-height: 1.2em; text-align:center">
        <p>* 你已完成3次预测练习，接下来将进入正式预测阶段。</p>
        </div>
        <p>`,
            button_lable: '进入正式预测阶段',
            delay_after: 100
        }
        //timeline.push(practice_trial_intro)

    /* Blocks: 7 days self-prediction */
    var self_pre_trial_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em; text-align:center">【预测阶段一】</p></br>
        <div style="font:1.5rem /* 24/16 */ SimSun; line-height: 1.2em; text-align:center">
        <p>· 本阶段需要完成<font color='red'>7次</font>蛋糕销量预测任务。</p>
        <p>· 每一次预测任务都有助于你未来更好地预测加盟店的蛋糕销量，因此请认真对待！</p>
        <p style='color:red;'>· 完整完成7次预测任务是获得基本酬金的必要条件。</p>
        </div>
        <p>`,
            button_lable: '进入预测阶段一',
            delay_after: 100
        }
        //timeline.push(self_pre_trial_intro)

    var self_predict_practice = {
            type: jsPsychSurvey,
            data: {
                taskdate_1: jsPsych.timelineVariable('Date'),
                task: 'self_predict_per_task'
            },
            pages: [
                [{
                    type: 'html',
                    prompt: function() {
                        var html = `
                    <p style="font: 1.5rem 微软雅黑; text-align: center; line-height: 1.5em;color:Gray; ">蛋糕销量预测</p></br>
                <p class='context' style='line-height: 1.2em'>
                请你根据以下信息预测蛋糕销量(提前制作蛋糕数量）：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.3rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br></br>
                <p class='context' style=' line-height: 1em'>
                请根据提供的7项信息，进行预测：</p>
                `;
                        return html;
                    }
                }, {
                    type: 'text',
                    prompt: '1. 你预计制作多少个蛋糕？',
                    name: 'pred_num_practice',
                    required: true
                }, {
                    type: 'likert',
                    prompt: '2. 你对自己的预测结果有多大信心？',
                    name: 'pred_confi_practice',
                    required: true,
                    likert_scale_min_label: '完全没有信心',
                    likert_scale_max_label: '非常有信心',
                    likert_scale_values: [{
                        value: 1,
                    }, {
                        value: 2
                    }, {
                        value: 3
                    }, {
                        value: 4
                    }, {
                        value: 5
                    }, {
                        value: 6
                    }, {
                        value: 7
                    }]
                }]
            ],
            button_label_finish: '查看真实销量'
        }
        //timeline.push(self_predict_practice)

    var self_predict_result_eval = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            task: 'self_pre_eval',
            turevalue: jsPsych.timelineVariable('Sales'),
        },
        stimulus: function() {
            var self_pre = jsPsych.data.get().filter({
                taskdate_1: jsPsych.timelineVariable('Date')
            }).values()[0]
            var self_pre = eval(JSON.parse(JSON.stringify(self_pre))).response.pred_num_practice
            var ture_sale = jsPsych.timelineVariable('Sales')
            var bias = (Math.abs(self_pre - ture_sale)) / ture_sale
            if (bias == 0) {
                var daily_profit = 10
            } else if (0 < bias <= 0.04) {
                var daily_profit = 9
            } else if (0.04 < bias <= 0.08) {
                var daily_profit = 8
            } else if (0.08 < bias <= 0.12) {
                var daily_profit = 7
            } else if (0.12 < bias <= 0.16) {
                var daily_profit = 6
            } else if (0.16 < bias <= 0.20) {
                var daily_profit = 5
            } else if (0.2 < bias <= 0.24) {
                var daily_profit = 4
            } else if (0.24 < bias <= 0.28) {
                var daily_profit = 3
            } else if (0.28 < bias <= 0.32) {
                var daily_profit = 2
            } else if (0.32 < bias <= 0.36) {
                var daily_profit = 1
            } else {
                var daily_profit = 0
            }
            var bias_percent = bias * 100
            var bias_percent = bias_percent.toFixed(2)
                //修改了每次反馈的内容，不要直观地反馈收益
                //<p>你本次的预测偏差为 <b> ${bias_percent}% </b> </p>
                //<p>你本次的预测收益为 <b> ${daily_profit} </b>元</p>
            return `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【销量预测结果评估】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>实际销量为 ${ture_sale} 个</p>
                            <p>你的预测为 ${self_pre} 个</p>
                            <p>你本次的预测偏差为 <b> ${bias_percent}% </b> </p>
                            </br>
                            <p style='color:Gray;'>（按任意键继续）</p>
                            </div>`
        },
    }

    var self_pre_7 = {
            timeline: [self_predict_practice, self_predict_result_eval],
            timeline_variables: prac_samples_7,
            data: {
                phase: 'self_pre_7'
            },
        }
        //timeline.push(self_pre_7)



    var self_pre_7_end = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【预测阶段一结束】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>请点击按钮进入<b>预测阶段二</b>。</p></br>
                            </br></br>
                            </div>
                <p>`,
            button_label: '进入预测阶段二',
            delay_after: 100
        }
        //timeline.push(self_pre_7_end);

    /*操纵环节*/
    var exp_manipu_phase1_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【预测阶段二】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>本阶段需要做<b>5次</b>销量预测。</p></br>
                            <p style='color:red;'>你的决策会影响本阶段的浮动收益，因此请认真阅读信息。</p></br></br>
                            </div>
                <p>`,
            button_label: '开始预测阶段二',
            delay_after: 100
        }
        //timeline.push(self_pre_7_end);

    var exp_manipu_interest_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `

        <div style="max-width: 100%; margin:0 atuo; ">    
        <p style="font: 20pt 微软雅黑; text-align: center; line-height: 1.5em">【本阶段浮动酬金提醒】</p></br>

        <div class='context' style='line-height: 1.5em; font-height:100'>接下来的所有预测环节的收益取决于你的预测表现，<font color="red">最终的浮动实验报酬等于单次预测的收益之和</font>。</br></br>
        <div style='text-indent:6rem /* 50/16 */; line-height: 1.1em; font-size:1.1rem; font-family: "微软雅黑";font-weight:100; '>
            <p>· <b> 每一次预测最高可获得5元的报酬。例如，预测5次，最高可获得25元。</b>
                <p>· <b> 单次预测偏差=|预测值-真实值|/真实值</b>
                <p>· 偏差为<font color="red">0</font>，单次预测收益<font color="red">5元</font>；
                <p>· 偏差不超过<font color="red">8%</font>，单次预测收益<font color="red">4元</font>；
                <p>· 偏差不超过<font color="red">16%</font>，单次预测收益<font color="red">3元</font>；
                <p>· 偏差不超过<font color="red">24%</font>，单次预测收益<font color="red">2元</font>；
                <p>· 偏差不超过<font color="red">32%</font>，单次预测收益<font color="red">1元</font>；
                <p>· 偏差超过<font color="red">32%</font>，单次预测收益<font color="red">0元</font>.
                </div>
        </div>  
               </br>
                
            <p>`,
            button_label: '已了解浮动酬金规则',
            delay_after: 100
        }
        //timeline.push(exp_manipu_interest_intro);

    var exp_manipu_algo_intro_1 = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `

        <div style="max-width: 100%; margin:0 atuo; ">    
        <p style="font: 20pt 微软雅黑; text-align: center; line-height: 1.5em">【蛋糕销量预测算法】</p></br></br>

        <p style="font:1.5rem SimSun; line-height: 1.2em; text-align:left; color:black">
                请注意！你所在的烘培加盟店的母公司邀请一家AI算法公司（AIplus）设计了一个<font color='red'>蛋糕销量预测算法</font>。</br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.5em'>· 该算法是针对蛋糕销量预测的。</p>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.5em'>· 该算法使用是需要付费的，<font color="red">5元购买一次，每次购买可以提供5次预测</font>。</p>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.5em'>· 该算法是基于过去的蛋糕销售数据得到的，使用的信息与你看到的7项信息相同。 </p>               
                </br>
                <p style="font:1.5rem SimSun; line-height: 1.2em; text-align:left; color:black">
                * 在接下来的预测环节中，你需要<font color='red'>决定是自己预测还是购买算法预测</font>。</br>

                <p style="font:1.5rem SimSun; line-height: 1.2em; text-align:left; color:black">
                * 该算法企业强调了<font color='red'>使用该预测算法时需要注意的几点问题</font>。</br>

              </div>                   
            <p>`,
            button_label: '查看算法注意点',
            delay_after: 100
        }
        //timeline.push(exp_manipu_algo_intro_1)

    var exp_manipu_algo_intro_2 = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            data: {
                taskdate_1: jsPsych.timelineVariable('Date'),
                phasename: 'exp1_algo_intro'
            },
            message: `

        <div style="max-width: 100%; margin:0 atuo; ">    
        <p style="font: 20pt 微软雅黑; text-align: center; line-height: 1.5em">【蛋糕销量预测算法】</p></br></br>

        <div style="font:1.4rem SimSun; line-height: 1.3em; text-align:left; color:black">
                <b> * 关于这个预测算法，请注意以下几点：</br>
                <p style='text-indent:3rem /* 50/16 */;'> · 这个算法在每次预测时需要花费一段时间（大留5-10秒）。</p>
                <p style='text-indent:3rem /* 50/16 */;'> · 这个算法<font color="red">不是百分百预测准确</font>的。</p>
                <p style='text-indent:3rem /* 50/16 */;'> · 对于你即将要进行的小样本销量预测任务，这个<font color="red">算法可能比你表现的好，也可能比你表现的差</font>。</p>      
                <p style='text-indent:3rem /* 50/16 */;'> · <font color="red">总的来说，无法保证短期小样本预测任务中是你自己预测收益高还是算法预测收益高</font>。</p>    
                </br>

                <p> 为了更好地决定是否购买并使用算法，请访问该蛋糕销量预测算法的介绍网页。</br>

                <p> 该页面包含<span style="text-decoration:underline">算法预测目标、代码设计、实现和优化等开发环节</span>的信息介绍。</p></b>

                <p> <font color="red"> 请仔细阅读算法介绍页面！（介绍页面会强制停留15-20秒，请耐心阅读并等待，出现“下一页”按钮即可跳转）</font></p>
                
                </div> </br></br>                  
            <p>`,
            button_label: '访问算法介绍页面',
            delay_after: 100
        }
        //timeline.push(exp_manipu_algo_intro_2)



    //不会显示出来
    var exp_manipu_intro_copy = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: ``,
        //button_label: '查看算法介绍页面',
        delay_after: 100
    }


    var exp_algorithm_web_0 = {
        type: jsPsychExternalHtml,
        url: 'Algorithm_intro_control.html',
        cont_btn: 'return',
        data: {
            task: 'AIAD_manip',
            AIAD_info: 'AI算法'
        }
    }
    var exp_algorithm_web_0_show = {
            timeline: [exp_algorithm_web_0],
            conditional_function: function() {
                if (conditional_web == 0) {
                    return true;
                } else {
                    return false;
                }
            }
        }
        //timeline.push(exp_algorithm_web_0_show);



    var exp_algorithm_web_1 = {
        type: jsPsychExternalHtml,
        url: 'Algorithm_intro_experts.html',
        cont_btn: 'return',
        data: {
            task: 'AIAD_manip',
            AIAD_info: '由算法工程师制定目标、设计、实现和完善的AI算法'
        }
    }
    var exp_algorithm_web_1_show = {
            timeline: [exp_algorithm_web_1],
            conditional_function: function() {
                if (conditional_web == 1) {
                    return true;
                } else {
                    return false;
                }
            }
        }
        //timeline.push(exp_algorithm_web_1_show);

    var exp_algorithm_web_2 = {
        type: jsPsychExternalHtml,
        url: 'Algorithm_intro_user_advising.html',
        cont_btn: 'return',
        data: {
            task: 'AIAD_manip',
            AIAD_info: '由多名其他烘焙店的店主制定目标并参与优化，算法工程师设计、实现和完善的AI算法'
        }
    }
    var exp_algorithm_web_2_show = {
            timeline: [exp_algorithm_web_2],
            conditional_function: function() {
                if (conditional_web == 2) {
                    return true;
                } else {
                    return false;
                }
            }
        }
        //timeline.push(exp_algorithm_web_2_show);


    //var exp_algorithm_web_3 = {
    //    type: jsPsychExternalHtml,
    //    url: 'Algorithm_intro_user_doing.html',
    //    cont_btn: 'return',
    //    data: {
    //        task: 'AIAD_manip',
    //        AIAD_info: '由多名其他烘焙店的店主制定目标，并与算法工程师一起设计、实现和完善的AI算法'
    //    }
    //}
    //var exp_algorithm_web_3_show = {
    //    timeline: [exp_algorithm_web_3],
    //    conditional_function: function() {
    //        if (conditional_web == 3) {
    //            return true;
    //        } else {
    //            return false;
    //        }
    //    }
    //}
    //timeline.push(exp_algorithm_web_3_show);



    likert_scale = [{
        value: 1,
    }, {
        value: 2
    }, {
        value: 3
    }, {
        value: 4
    }, {
        value: 5
    }, {
        value: 6
    }, {
        value: 7
    }];


    //操纵检验
    var manipulation_check = {
            type: jsPsychSurvey,
            data: {
                phasename: 'manipulation_check',
            },
            pages: [
                [{
                    type: 'html',
                    prompt: function() {
                        var html = `                       
                            首先，请根据你看到的算法介绍页面，回答以下问题：
                        `
                        return html
                    }
                }, {
                    type: 'multi-select',
                    prompt: '· 该预测算法开发过程中有哪些人参与？(可多选）',
                    options: ["没有介绍包括哪些人", "AI算法工程师", "蛋糕消费者", "烘焙店店主", "总公司销售人员"],
                    name: 'manipulation_check_1',
                    required: true,
                }, {
                    type: 'multi-select',
                    prompt: '· 该预测算法的开发包含哪些环节？（可多选）',
                    options: ["目标制定", "算法设计", "算法实现", "算法优化", "算法宣传"],
                    name: 'manipulation_check_2',
                    required: true,
                }, {
                    type: 'multi-select',
                    prompt: '· 关于本实验中提到的算法，以下哪些说法是正确的？（可多选）',
                    options: ["这个算法是基于AI实现的预测算法", "算法开发过程中全部是专业的算法工程师", "这个算法的预测正确率是100%", "这个算法到是免费使用的"],
                    name: 'manipulation_check_3',
                    required: true,
                }, ]
            ],
            button_label_finish: '继续实验'
        }
        //timeline.push(manipulation_check)

    var exp_algo_delegation_1 = {
            type: jsPsychSurvey,
            pages: [
                [{
                    type: 'html',
                    prompt: `
                            <p style='line-height: 1.2em'>* 本阶段需要你连续做出<font color="red">5次销量预测</font>。</p>
                            <p style='line-height: 1.2em'>* 对于接下来5次的预测收益，你有<font color="red">两种选择</font>:</p>
                            <p style='text-indent:2.1875rem /* 35/16 */; line-height: 1.2em'>① <font color="red">由自己进行5轮预测</font>，并将 <font color="red">自己预测的5次收益之和</font>作为本预测阶段的收益</p>
                            <p style='text-indent:2.1875rem /* 35/16 */; line-height: 1.2em'>② <font color="red">花费5元购买算法进行5轮预测</font>，并将 <font color="red">算法预测的5次收益之和</font>作为本预测阶段的收益</p>
                            
                            `
                }, {
                    type: 'likert',
                    prompt: '· 请问你有多大意愿购买该算法预测接下来5次的蛋糕销量？',
                    required: true,
                    likert_scale_min_label: '完全不愿购买算法',
                    likert_scale_max_label: '非常愿意购买算法',
                    likert_scale_values: likert_scale
                }, {
                    type: 'multi-choice',
                    prompt: '· 请你决定是否购买并使用该算法为你做接下来5次的销量预测:',
                    options: ["不购买算法", "购买并使用算法"],
                    required: true,
                }]
            ],
            data: {
                task: 'delegate_decision_1'
            },
            button_label_finish: '继续'
        }
        //timeline.push(exp_algo_delegation_1)

    var algo_delegation_yes_1_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: function() {
                var team_intro_info = jsPsych.data.get().filter({
                    task: 'AIAD_manip'
                }).values()[0]
                var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                var html = `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:black; text-align:center">【你已授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
            <p>接下来你将依次看到<font color='red'>5次算法预测结果</font>。</p></br>
            <p><font color='Gray'>（每次算法预测需花费5-7秒，请耐心等待！）</font>。</p></br>
         
            </div>
            <p>`;
                return html;
            },
            delay_after: 100,
            button_label: '继续',
        }
        //timeline.push(algo_delegation_yes_1_intro);

    var if_shown_algo_delegation_yes_1_intro = {
        timeline: [algo_delegation_yes_1_intro],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_1'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_algo_delegation_yes_1_intro)

    var algo_delegation_no_1_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: function() {
                var team_intro_info = jsPsych.data.get().filter({
                    task: 'AIAD_manip'
                }).values()[0]
                var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                var html = `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:black; text-align:center">【你未授权 <b>${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
            <p>接下来你将<font color='red'>自己依次进行5次销量预测</font>。</p></br>
         
            </div>
            <p>`;
                return html;
            },
            delay_after: 100,
            button_label: '继续',
        }
        //timeline.push(algo_delegation_yes_1_intro);

    var if_shown_algo_delegation_no_1_intro = {
        timeline: [algo_delegation_no_1_intro],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_1'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    // timeline.push(if_shown_algo_delegation_no_1_intro)

    var algo_gap_time_part1 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var html = `

                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你已购买并授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    本次算法预测详情如下：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br>
                <p>算法正在进行预测……</p></br><br>
                `;
            return html;
        },
        choices: ['剩余<span id="timer"> 5 </span>秒'],
        button_html: btn_html_timer,
    }


    var algo_delegate_yes_1 = {
        type: jsPsychSurvey,
        data: {
            task: 'exp_detail_info',
            turevalue: jsPsych.timelineVariable('Sales'),
            predictvalue: jsPsych.timelineVariable('pre_3'),
            taskdate: jsPsych.timelineVariable('Date')
        },
        pages: [
            [{
                type: 'html',
                prompt: function() {
                    var team_intro_info = jsPsych.data.get().filter({
                        task: 'AIAD_manip'
                    }).values()[0]
                    var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                    var html = `

                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你已授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    本次算法预测详情如下：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br>
                `;
                    return html;
                }
            }, {
                type: 'html',
                prompt: function() {
                    var html = `
                    <p style="font:1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em; text-align:left; color:black">
                    · 算法的预测结果为：<b>${jsPsych.timelineVariable('pre_3')}</b>个。</p>
                `
                    return html
                }
            }, {
                type: 'likert',
                prompt: '· 如果本次你自己预测，你认为你自己的预测结果和算法的预测结果哪一个更接近真实的销量？（越接近7则认为算法结果更好）',
                name: 'algo_delegate_comparison',
                required: true,
                likert_scale_min_label: '自己的预测结果',
                likert_scale_max_label: '算法的预测结果',
                likert_scale_values: likert_scale
            }]
        ],
        button_label_finish: '继续预测'
    }

    var if_shown_algo_delegation_1 = {
        timeline: [algo_gap_time_part1, algo_delegate_yes_1],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_1'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };

    //选择不使用算法
    var algo_delegation_no_1 = {
        type: jsPsychSurvey,
        data: {
            task: 'exp_detail_info',
            taskdate: jsPsych.timelineVariable('Date'),
            turevalue: jsPsych.timelineVariable('Sales'),
        },
        pages: [
            [{
                type: 'html',
                prompt: function() {
                    var team_intro_info = jsPsych.data.get().filter({
                        task: 'AIAD_manip'
                    }).values()[0]
                    var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                    var html = `
                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你未授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    请你根据以下信息进行预测: </p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                    <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')}</p>
                </div>
                </br>
                `;
                    return html;
                }
            }, {
                type: 'text',
                prompt: '· 你预计制作多少个蛋糕？',
                name: 'pred_num',
                required: true
            }, {
                type: 'likert',
                prompt: '· 你对自己的预测结果有多大信心？',
                name: 'pred_confi_practice',
                required: true,
                likert_scale_min_label: '完全没有信心',
                likert_scale_max_label: '非常有信心',
                likert_scale_values: likert_scale
            }, {
                type: 'likert',
                prompt: '· 如果本次算法也参与预测，你认为你自己的预测结果和算法的预测结果哪一个更接近真实的销量？（越接近7则认为算法结果更好）',
                name: 'algo_delegate_comparison',
                required: true,
                likert_scale_min_label: '自己的预测结果',
                likert_scale_max_label: '算法的预测结果',
                likert_scale_values: likert_scale
            }]
        ],
        button_label_finish: '提交结果'
    }

    var pred_notice = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: `
        <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">预测结果提交成功！</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p></p>
        </div>
        <p>`,
        button_lable: '继续实验',
        delay_after: 100
    }

    var if_shown_no_algo_delegation_1 = {
        timeline: [algo_delegation_no_1, pred_notice],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_1'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };


    var exp_delegation_part1 = {
            timeline: [if_shown_algo_delegation_1, if_shown_no_algo_delegation_1],
            timeline_variables: exp_sales_stimuli_part1,
            data: {
                phase: 'exp_delegation_part1'
            },
        }
        //timeline.push(exp_delegation_part1)

    var key_factors_survey_1 = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">【问卷填写】</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p>接下来你将进入第一阶段的问卷填写。</p>
        <p>请根据你目前看到的信息和判断认真填写！</p>
        </div>
        <p>`,
            button_lable: '填写问卷',
            delay_after: 100
        }
        //timeline.push(key_factors_survey_1)

    var variables_measurement = {
            type: jsPsychSurvey,
            data: {
                phasename: 'exp_phase1_survey',
            },
            pages: [
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 1/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: function() {
                        var delegated = jsPsych.data.get().filter({
                            task: 'delegate_decision_1'
                        }).values()[0]
                        var delegated = JSON.stringify(delegated)
                        var delegated = eval(JSON.parse(delegated)).response.P0_Q2
                        var team_intro_info = jsPsych.data.get().filter({
                            task: 'AIAD_manip'
                        }).values()[0]
                        var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                        var html = `                       
                            当看到<b>${algo_info}</b>时，请列出三个理由说明你为什么选择 <font color='red'>${delegated}</font> ：
                        `
                        return html
                    }
                }, {
                    type: 'text',
                    prompt: '理由1：',
                    textbox_rows: 1,
                    name: 'decision_reason_1',
                    required: true
                }, {
                    type: 'text',
                    prompt: '理由2:',
                    textbox_rows: 1,
                    name: 'decision_reason_2',
                    required: true
                }, {
                    type: 'text',
                    prompt: '理由3:',
                    textbox_rows: 1,
                    name: 'decision_reason_3',
                    required: true
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 2/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: function() {
                        var team_intro_info = jsPsych.data.get().filter({
                            task: 'AIAD_manip'
                        }).values()[0]
                        var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                        if (algo_info == 'AI算法') {
                            img_path = 'images/Algorithm_control_web.png'
                        } else if (algo_info == '由算法工程师制定目标、设计、实现和完善的AI算法') {
                            img_path = 'images/Algorithm_experts_web.png'
                        } else if (algo_info == '由多名其他烘焙店的店主制定目标并参与优化，算法工程师设计、实现和完善的AI算法') {
                            img_path = 'images/Algorithm_user_advising_web.png'
                        }
                        var html = `                       
                        <p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">你之前看到的算法介绍页面如下:</p></br> </br> 
                        <p style="text-align:center"><img src=${img_path} width='70%'/></p></br>
                        <p></p> <p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">在没有得到算法预测结果反馈之前，根据算法信息，你在多大程度上同意以下说法：</p> 
                        `
                        return html
                    }

                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍页面中AI算法开发过程推测，该公司具备设计出合格预测算法的高能力。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Ability_1',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍页面中AI算法开发过程推测，该公司具备很强的能力提供一个合格的AI预测算法。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Ability_2',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍页面中AI算法开发过程推测，这个公司在设计AI预测算法时的能力很出色。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Ability_3',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍页面中AI算法开发过程推测，这个预测算法的设计目标和你的预测目标完全一致。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Goal_alignment_1',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍页面中AI算法开发过程推测，这个预测算法考虑到了终端用户（烘焙店店主）的真正需求。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Goal_alignment_2',
                    likert_scale_values: likert_scale,
                    required: true,
                }, ],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 3/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: `<p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">根据算法的介绍信息，你在多大程度上同意以下说法：</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 我认可这个公司的算法开发团队。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Indentification_1',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '·我和这个公司的算法开发团队关系亲近。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Indentification_2',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我和这个公司的算法开发团队之间存在关系纽带。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Indentification_3',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我和这个公司的算法开发团队之间有关联。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Indentification_4',
                    required: true,
                }, ],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 4/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: `<p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">你在多大程度上同意以下说法：</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 根据已有的算法信息推测，该算法预测比我自己预测更有准确性优势。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Effectiveness_1',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 蛋糕销量预测的工作有趣。（请你选择4）',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'attention_check_1',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据已有的算法信息推测，该算法的预测结果是有用的。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Effectiveness_2',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据已有的算法信息推测，这个算法的预测表现会比较好。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Effectiveness_3',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 这个算法在开发过程中是客观的、不存在主观臆断的。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'objective_1',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据已有的算法信息推测，这个算法的预测结果是中立且无偏的。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'objective_2',
                    required: true,
                }, ],

                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 5/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: function() {
                        var team_intro_info = jsPsych.data.get().filter({
                            task: 'AIAD_manip'
                        }).values()[0]
                        var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info

                        var html = `
                           
                            <div style='text-indent:2.1875rem /* 35/16 */; line-height: 1.2em; font-weight:500'>
                            <p >在心理学中，控制指的是个人感知自己具备的影响自己、他人、环境的能力，对自己或他人的控制可以影响个人的情绪和行为。</p>
                            <p >研究表明，在AI情境下，<b>有人认为自己完全没有能力去控制AI</b>，AI完全是失控的；<b>也有人认为自己可以自由地控制AI</b>设计、使用和更新等环节。</p>
                            <p >根据对控制的介绍，以及你了解的<b>${algo_info}</b>，回答下列问题。`
                        return html
                    }
                }, {
                    type: 'likert',
                    prompt: '· 你认为该算法的预测过程和结果是可控的吗？',
                    likert_scale_min_label: '完全不可控',
                    likert_scale_max_label: '完全可控',
                    likert_scale_values: likert_scale,
                    name: 'Control level',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 你认为你对当前这个预测算法从设计到得到结果的整体控制感有多大？',
                    likert_scale_min_label: '控制感很低',
                    likert_scale_max_label: '控制感很高',
                    likert_scale_values: likert_scale,
                    name: 'Perceived_control1',
                    required: true,
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 6/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: `<p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">根据算法介绍和使用体验，你在多大程度上同意以下说法：</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 面对这个算法时，我自己的能力和地位足够强大。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Perceived_control2_1',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我可以控制这个算法。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Perceived_control2_2',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我有能力改变这个算法。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Perceived_control2_3',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我可以影响这个算法的开发过程和它得到的结果。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Perceived_control2_4',
                    required: true,
                }, ],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 7/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: `<p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">根据算法介绍和使用体验，你在多大程度上同意以下说法：</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍和使用体验，我认为该算法可以预测出准确的蛋糕销量。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Trust1',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍和使用体验，我认为这是一个值得信任的算法。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Trust1_2',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍和使用体验，我会依赖这个算法为自己提供一个精确的预测值。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Trust1_3',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 根据算法介绍和使用体验，我认为这个算法的设计意图是好的。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Trust1_4',
                    required: true,
                }],

                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 8/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: `<p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">你在多大程度上同意以下说法：</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 蛋糕销量预测工作是一项复杂的工作。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Complexity',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 蛋糕预测任务很简单。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Simplity',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我有信心独立预测蛋糕销量。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    likert_scale_values: likert_scale,
                    name: 'Self-Confidence',
                    required: true,
                }, {
                    type: 'multi-choice',
                    prompt: '· 我会因为想尽快结束本次实验而选择使用算法。',
                    options: ["会", "不会"],
                    required: true,
                    name: 'attention_check_2'
                }],
            ],
            button_label_back: '上一页',
            button_label_next: '下一页',
            button_label_finish: '继续实验'
        }
        //timeline.push(variables_measurement);

    var exp_manipu_phase1_end = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【预测阶段二结束】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>* 本轮5次预测任务已经结束。</p>
                            <p>* 请点击按钮进入<b>预测阶段三</b>。</p></br>
                            </br></br>
                            </div>
                <p>`,
        button_label: '进入预测阶段三',
        delay_after: 100
    }

    //************************下一轮实验设计***********************
    var exp_algo_delegation_2_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【预测阶段三】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>* 本阶段你依然要连续做出<b>5次销量预测</b>。</p>
                            <p>* 本阶段的<b>实验规则和酬金政策与阶段二相同</b>。</p>
                            <p>* 请点击按钮正式进入<b>预测阶段三</b>。</p></br>
                            <p style='color:red;'>你的决策会影响本阶段的浮动收益，因此请认真阅读信息。</p></br></br>
                            </div>
                <p>`,
            button_label: '进入预测阶段三',
            delay_after: 100
        }
        //timeline.push(exp_algo_delegation_2_intro);

    var exp_algo_delegation_2 = {
            type: jsPsychSurvey,
            pages: [
                [{
                    type: 'html',
                    prompt: `
                            <p style='line-height: 1.2em'>* 本阶段依然需要你连续做出<font color="red">5次销量预测</font>。</p>
                            <p style='line-height: 1.2em'>* 对于接下来5次的预测收益，你有<font color="red">两种选择</font>:</p>
                            <p style='text-indent:2.1875rem /* 35/16 */; line-height: 1.2em'>① <font color="red">由自己进行5轮预测</font>，并将 <font color="red">自己预测的5次收益之和</font>作为本预测阶段的收益</p>
                            <p style='text-indent:2.1875rem /* 35/16 */; line-height: 1.2em'>② <font color="red">花费5元购买算法进行5轮预测</font>，并将 <font color="red">算法预测的5次收益之和</font>作为本预测阶段的收益</p>
                            
                            `
                }, {
                    type: 'likert',
                    prompt: '· 请问你有多大意愿购买该算法预测接下来5次的蛋糕销量？',
                    required: true,
                    likert_scale_min_label: '完全不愿购买算法',
                    likert_scale_max_label: '非常愿意购买算法',
                    likert_scale_values: likert_scale
                }, {
                    type: 'multi-choice',
                    prompt: '· 请你决定是否购买并使用该算法为你做接下来5次的销量预测:',
                    options: ["不购买算法", "购买并使用算法"],
                    required: true,
                }]
            ],
            data: {
                task: 'delegate_decision_2'
            },
            button_label_finish: '继续'
        }
        //timeline.push(exp_algo_delegation_2)

    var algo_delegation_yes_2_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: function() {
                var team_intro_info = jsPsych.data.get().filter({
                    task: 'AIAD_manip'
                }).values()[0]
                var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                var html = `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:black; text-align:center">【你已授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
            <p>接下来你将依次看到<font color='red'>5次算法预测结果</font>。</p></br>
            <p><font color='Gray'>（每次算法预测需花费5-7秒，请耐心等待！）</font>。</p></br>
         
            </div>
            <p>`;
                return html;
            },
            delay_after: 100,
            button_label: '继续',
        }
        //timeline.push(algo_delegation_yes_2_intro);

    var if_shown_algo_delegation_yes_2_intro = {
        timeline: [algo_delegation_yes_2_intro],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_2'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_algo_delegation_yes_2_intro)

    var algo_delegation_no_2_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: function() {
                var team_intro_info = jsPsych.data.get().filter({
                    task: 'AIAD_manip'
                }).values()[0]
                var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                var html = `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:black; text-align:center">【你未授权 <b>${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
            <p>接下来你将<font color='red'>自己依次进行5次销量预测</font>。</p></br>
         
            </div>
            <p>`;
                return html;
            },
            delay_after: 100,
            button_label: '继续',
        }
        //timeline.push(algo_delegation_yes_1_intro);

    var if_shown_algo_delegation_no_2_intro = {
        timeline: [algo_delegation_no_2_intro],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_2'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_algo_delegation_no_2_intro)

    var algo_gap_time_part2 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var html = `

                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你已购买并授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    本次算法预测详情如下：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br>
                <p>算法正在进行预测……</p></br><br>
                `;
            return html;
        },
        choices: ['剩余<span id="timer"> 5 </span>秒'],
        button_html: btn_html_timer,
    }


    var algo_delegate_yes_2 = {
        type: jsPsychSurvey,
        data: {
            task: 'exp_detail_info',
            turevalue: jsPsych.timelineVariable('Sales'),
            predictvalue: jsPsych.timelineVariable('pre_3'),
            taskdate: jsPsych.timelineVariable('Date')
        },
        pages: [
            [{
                type: 'html',
                prompt: function() {
                    var team_intro_info = jsPsych.data.get().filter({
                        task: 'AIAD_manip'
                    }).values()[0]
                    var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                    var html = `

                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你已授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    本次算法预测详情如下：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br>
                `;
                    return html;
                }
            }, {
                type: 'html',
                prompt: function() {
                    var html = `
                    <p style="font:1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em; text-align:left; color:black">
                    · 算法的预测结果为：<b>${jsPsych.timelineVariable('pre_3')}</b>个。</p>
                `
                    return html
                }
            }, {
                type: 'likert',
                prompt: '· 如果本次你自己预测，你认为你自己的预测结果和算法的预测结果哪一个更接近真实的销量？（越接近7则认为算法结果更好）',
                name: 'algo_delegate_comparison',
                required: true,
                likert_scale_min_label: '自己的预测结果',
                likert_scale_max_label: '算法的预测结果',
                likert_scale_values: likert_scale
            }]
        ],
        button_label_finish: '继续预测'
    }

    var if_shown_algo_delegation_2 = {
        timeline: [algo_gap_time_part2, algo_delegate_yes_2],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_2'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };

    //选择不使用算法
    var algo_delegation_no_2 = {
        type: jsPsychSurvey,
        data: {
            task: 'exp_detail_info',
            taskdate: jsPsych.timelineVariable('Date'),
            turevalue: jsPsych.timelineVariable('Sales'),
        },
        pages: [
            [{
                type: 'html',
                prompt: function() {
                    var team_intro_info = jsPsych.data.get().filter({
                        task: 'AIAD_manip'
                    }).values()[0]
                    var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                    var html = `
                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你未授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    请你根据以下信息进行预测: </p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                    <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')}</p>
                </div>
                </br>
                `;
                    return html;
                }
            }, {
                type: 'text',
                prompt: '· 你预计制作多少个蛋糕？',
                name: 'pred_num',
                required: true
            }, {
                type: 'likert',
                prompt: '· 你对自己的预测结果有多大信心？',
                name: 'pred_confi_practice',
                required: true,
                likert_scale_min_label: '完全没有信心',
                likert_scale_max_label: '非常有信心',
                likert_scale_values: likert_scale
            }, {
                type: 'likert',
                prompt: '· 如果本次算法也参与预测，你认为你自己的预测结果和算法的预测结果哪一个更接近真实的销量？（越接近7则认为算法结果更好）',
                name: 'algo_delegate_comparison',
                required: true,
                likert_scale_min_label: '自己的预测结果',
                likert_scale_max_label: '算法的预测结果',
                likert_scale_values: likert_scale
            }]
        ],
        button_label_finish: '提交结果'
    }

    var if_shown_no_algo_delegation_2 = {
        timeline: [algo_delegation_no_2, pred_notice],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_2'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };


    var exp_delegation_part2 = {
            timeline: [if_shown_algo_delegation_2, if_shown_no_algo_delegation_2],
            timeline_variables: exp_sales_stimuli_part2,
            data: {
                phase: 'exp_delegation_part2'
            },
        }
        //timeline.push(exp_delegation_part2)

    var key_factors_survey_2 = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">【5轮预测结束】</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p>* 你已完成本阶段的预测任务。</p>
        <p>* 接下来需要填写关于本阶段决策的一些问题。</p>
        </div>
        <p>`,
            button_lable: '填写问卷',
            delay_after: 100
        }
        //timeline.push(key_factors_survey_2)

    var variables_measurement_2 = {
            type: jsPsychSurvey,
            data: {
                phasename: 'exp_phase2_survey',
            },
            pages: [
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 1/1 】</p>`,
                }, {
                    type: 'html',
                    prompt: function() {
                        var delegated = jsPsych.data.get().filter({
                            task: 'delegate_decision_2'
                        }).values()[0]
                        var delegated = JSON.stringify(delegated)
                        var delegated = eval(JSON.parse(delegated)).response.P0_Q2
                        var team_intro_info = jsPsych.data.get().filter({
                            task: 'AIAD_manip'
                        }).values()[0]
                        var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                        var html = `                       
                            面对<b>${algo_info}</b>，你在第2次决定是否购买时选择了<font color='red'>${delegated}</font>，请列出你做出这个决定的理由 ：
                        `
                        return html
                    }
                }, {
                    type: 'text',
                    prompt: '理由1：',
                    textbox_rows: 1,
                    name: 'decision_reason_1',
                    required: true
                }, {
                    type: 'text',
                    prompt: '理由2:',
                    textbox_rows: 1,
                    name: 'decision_reason_2',
                    required: true
                }, {
                    type: 'text',
                    prompt: '理由3:',
                    textbox_rows: 1,
                    name: 'decision_reason_3',
                    required: true
                }]
            ],
            button_label_finish: '继续实验'
        }
        //timeline.push(variables_measurement_2)
    var exp_manipu_phase2_end = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【预测阶段三结束】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>* 本轮5次预测任务已经结束。</p>
                            <p>* 请点击按钮进入<b>预测阶段四</b>。</p></br>
                            </br></br>
                            </div>
                <p>`,
        button_label: '进入预测阶段四',
        delay_after: 100
    }


    //************************第三个5轮***********************
    var exp_algo_delegation_3_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【预测阶段四】</p></br>
                            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
                            <p>* 本阶段你依然需要连续做出<b>5次销量预测</b></p>
                            <p>* 本阶段的<b>实验规则和酬金规则与之前相同</b>。</p>
                            <p>* 请点击按钮进入<b>预测阶段四</b>。</p></br>
                            <p style='color:red;'>你的决策会影响本阶段的浮动收益，因此请认真阅读信息。</p></br></br>
                            </div>
                <p>`,
            button_label: '进入预测阶段四',
            delay_after: 100
        }
        //timeline.push(exp_algo_delegation_3_intro);

    var exp_algo_delegation_3 = {
            type: jsPsychSurvey,
            pages: [
                [{
                    type: 'html',
                    prompt: `
                            <p style='line-height: 1.2em'>* 本阶段依然需要你连续做出<font color="red">5次销量预测</font>。</p>
                            <p style='line-height: 1.2em'>* 对于接下来5次的预测收益，你有<font color="red">两种选择</font>:</p>
                            <p style='text-indent:2.1875rem /* 35/16 */; line-height: 1.2em'>① <font color="red">由自己进行5轮预测</font>，并将 <font color="red">自己预测的5次收益之和</font>作为本预测阶段的收益</p>
                            <p style='text-indent:2.1875rem /* 35/16 */; line-height: 1.2em'>② <font color="red">花费5元购买算法进行5轮预测</font>，并将 <font color="red">算法预测的5次收益之和</font>作为本预测阶段的收益</p>
                            
                            `
                }, {
                    type: 'likert',
                    prompt: '· 请问你有多大意愿购买该算法预测接下来5次的蛋糕销量？',
                    required: true,
                    likert_scale_min_label: '完全不愿购买算法',
                    likert_scale_max_label: '非常愿意购买算法',
                    likert_scale_values: likert_scale
                }, {
                    type: 'multi-choice',
                    prompt: '· 请你决定是否购买并使用该算法为你做接下来5次的销量预测:',
                    options: ["不购买算法", "购买并使用算法"],
                    required: true,
                }]
            ],
            data: {
                task: 'delegate_decision_3'
            },
            button_label_finish: '继续'
        }
        //timeline.push(exp_algo_delegation_3)

    var algo_delegation_yes_3_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: function() {
                var team_intro_info = jsPsych.data.get().filter({
                    task: 'AIAD_manip'
                }).values()[0]
                var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                var html = `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:black; text-align:center">【你已授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
            <p>接下来你将依次看到<font color='red'>5次算法预测结果</font>。</p></br>
            <p><font color='Gray'>（每次算法预测需花费5-7秒，请耐心等待！）</font>。</p></br>
         
            </div>
            <p>`;
                return html;
            },
            delay_after: 100,
            button_label: '继续',
        }
        //timeline.push(algo_delegation_yes_2_intro);

    var if_shown_algo_delegation_yes_3_intro = {
        timeline: [algo_delegation_yes_3_intro],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_3'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_algo_delegation_yes_3_intro)

    var algo_delegation_no_3_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: function() {
                var team_intro_info = jsPsych.data.get().filter({
                    task: 'AIAD_manip'
                }).values()[0]
                var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                var html = `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:black; text-align:center">【你未授权 <b>${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
            <div style="font:20pt SimSun; line-height: 1em; text-align:center; color:black">
            <p>接下来你将<font color='red'>自己依次进行5次销量预测</font>。</p></br>
         
            </div>
            <p>`;
                return html;
            },
            delay_after: 100,
            button_label: '继续',
        }
        //timeline.push(algo_delegation_yes_1_intro);

    var if_shown_algo_delegation_no_3_intro = {
        timeline: [algo_delegation_no_3_intro],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_3'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_algo_delegation_no_3_intro)

    var algo_gap_time_part3 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var html = `

                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你已购买并授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    本次算法预测详情如下：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br>
                <p>算法正在进行预测……</p></br><br>
                `;
            return html;
        },
        choices: ['剩余<span id="timer"> 5 </span>秒'],
        button_html: btn_html_timer,
    }


    var algo_delegate_yes_3 = {
        type: jsPsychSurvey,
        data: {
            task: 'exp_detail_info',
            turevalue: jsPsych.timelineVariable('Sales'),
            predictvalue: jsPsych.timelineVariable('pre_3'),
            taskdate: jsPsych.timelineVariable('Date')
        },
        pages: [
            [{
                type: 'html',
                prompt: function() {
                    var team_intro_info = jsPsych.data.get().filter({
                        task: 'AIAD_manip'
                    }).values()[0]
                    var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                    var html = `

                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你已授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    本次算法预测详情如下：</p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')} </p>
                </div>
                </br>
                `;
                    return html;
                }
            }, {
                type: 'html',
                prompt: function() {
                    var html = `
                    <p style="font:1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em; text-align:left; color:black">
                    · 算法的预测结果为：<b>${jsPsych.timelineVariable('pre_3')}</b>个。</p>
                `
                    return html
                }
            }, {
                type: 'likert',
                prompt: '· 如果本次你自己预测，你认为你自己的预测结果和算法的预测结果哪一个更接近真实的销量？（越接近7则认为算法结果更好）',
                name: 'algo_delegate_comparison',
                required: true,
                likert_scale_min_label: '自己的预测结果',
                likert_scale_max_label: '算法的预测结果',
                likert_scale_values: likert_scale
            }]
        ],
        button_label_finish: '继续预测'
    }

    var if_shown_algo_delegation_3 = {
        timeline: [algo_gap_time_part3, algo_delegate_yes_3],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_3'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };

    //选择不使用算法
    var algo_delegation_no_3 = {
        type: jsPsychSurvey,
        data: {
            task: 'exp_detail_info',
            taskdate: jsPsych.timelineVariable('Date'),
            turevalue: jsPsych.timelineVariable('Sales'),
        },
        pages: [
            [{
                type: 'html',
                prompt: function() {
                    var team_intro_info = jsPsych.data.get().filter({
                        task: 'AIAD_manip'
                    }).values()[0]
                    var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                    var html = `
                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">【你未授权<b> ${algo_info}</b> 为你做接下来5次的销量预测】</p></br>
                <p class='context' style='text-indent:3.125rem /* 50/16 */; line-height: 1.2em'>
                    请你根据以下信息进行预测: </p>
                <div style="text-indent:4.375rem /* 70/16 */; font:1.4rem SimSun; line-height: 1em; text-align:left">
                    <p>① 日期：${jsPsych.timelineVariable('Date')}</font></p>
                <p>② 星期：${jsPsych.timelineVariable('Day')}</p>
                <p>③ 前一周平均每天人流量：${jsPsych.timelineVariable('Ave_traffic')} 人</p>
                <p>④ 制作传单数：${jsPsych.timelineVariable('Flyers')} 张</p>
                <p>⑤ 促销：${jsPsych.timelineVariable('Promotion')} </p>
                <p>⑥ 气温：${jsPsych.timelineVariable('Temperature')} °C</p>
                <p>⑦ 天气：${jsPsych.timelineVariable('Weather')}</p>
                </div>
                </br>
                `;
                    return html;
                }
            }, {
                type: 'text',
                prompt: '· 你预计制作多少个蛋糕？',
                name: 'pred_num',
                required: true
            }, {
                type: 'likert',
                prompt: '· 你对自己的预测结果有多大信心？',
                name: 'pred_confi_practice',
                required: true,
                likert_scale_min_label: '完全没有信心',
                likert_scale_max_label: '非常有信心',
                likert_scale_values: likert_scale
            }, {
                type: 'likert',
                prompt: '· 如果本次算法也参与预测，你认为你自己的预测结果和算法的预测结果哪一个更接近真实的销量？（越接近7则认为算法结果更好）',
                name: 'algo_delegate_comparison',
                required: true,
                likert_scale_min_label: '自己的预测结果',
                likert_scale_max_label: '算法的预测结果',
                likert_scale_values: likert_scale
            }]
        ],
        button_label_finish: '提交结果'
    }

    var if_shown_no_algo_delegation_3 = {
        timeline: [algo_delegation_no_3, pred_notice],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_3'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };

    var exp_delegation_part3 = {
            timeline: [if_shown_algo_delegation_3, if_shown_no_algo_delegation_3],
            timeline_variables: exp_sales_stimuli_part3,
            data: {
                phase: 'exp_delegation_part3'
            },
        }
        //timeline.push(exp_delegation_part3)

    var key_factors_survey_3 = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">【5轮预测结束】</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p>* 你已完成本阶段的预测任务。</p>
        <p>* 接下来需要填写关于本阶段决策的一些问题。</p>
        </div>
        <p>`,
            button_lable: '填写问卷',
            delay_after: 100
        }
        //timeline.push(key_factors_survey_3)

    var variables_measurement_3 = {
            type: jsPsychSurvey,
            data: {
                phasename: 'exp_phase3_survey',
            },
            pages: [
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 1/1 】</p>`,
                }, {
                    type: 'html',
                    prompt: function() {
                        var delegated = jsPsych.data.get().filter({
                            task: 'delegate_decision_3'
                        }).values()[0]
                        var delegated = JSON.stringify(delegated)
                        var delegated = eval(JSON.parse(delegated)).response.P0_Q2
                        var team_intro_info = jsPsych.data.get().filter({
                            task: 'AIAD_manip'
                        }).values()[0]
                        var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
                        var html = `                       
                            面对<b>${algo_info}</b>，在第3次连续五次预测的场景下，你选择了 <font color='red'>${delegated}</font>。</br>请说出做出这个决策的三个理由 ：
                        `
                        return html
                    }
                }, {
                    type: 'text',
                    prompt: '理由1：',
                    textbox_rows: 1,
                    name: 'decision_reason_1',
                    required: true
                }, {
                    type: 'text',
                    prompt: '理由2:',
                    textbox_rows: 1,
                    name: 'decision_reason_2',
                    required: true
                }, {
                    type: 'text',
                    prompt: '理由3:',
                    textbox_rows: 1,
                    name: 'decision_reason_3',
                    required: true
                }]
            ],
            button_label_finish: '继续实验'
        }
        //timeline.push(variables_measurement_3)


    //******************************第一次5轮预测结果反馈************************************
    var exp_feedback15_intro = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
            <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">【预测阶段结束】</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p>* 到现在为止，你已经完成了3次连续五轮的预测任务。</p>
        <p>* 接下来请依次查看预测任务的表现。</p>
        </div>
        <p>`,
            button_lable: '依次查看预测结果',
            delay_after: 100
        }
        //timeline.push(key_factors_survey_3)



    var exp_algo_part1_feedback = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            taskname: 'exp_part1_feedback',
        },
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part1',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).predictvalue
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            console.log(profit_list)
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
                console.log(sum)
            }
            console.log(sum)
                //average = Math.floor(average * 100) / 100
                //，此次收益为<b>${profit_list[0]}</b>元。(删掉了这次改版)

            return `
                            <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【你已授权 ${algo_info} 为你做第一轮5次的销量预测】</p></br>
                            <p style="font: 1.375rem /* 22/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">5次销量预测结果评估如下：</p></br>
                            <div style="font:1.25rem /* 20/16 */ SimSun; line-height: 1em; text-align:center; color:black">
                            <p>第1次：预测日期为${date_list[0]}，实际销量是${sale_list[0]}个，算法的预测为${prediction_list[0]}个，预测偏差为<b>${bias_percent_list[0]}%</b>。</p>
                            <p>第2次：预测日期为${date_list[1]}，实际销量是${sale_list[1]}个，算法的预测为${prediction_list[1]}个，预测偏差为<b>${bias_percent_list[1]}%</b>。</p>
                            <p>第3次：预测日期为${date_list[2]}，实际销量是${sale_list[2]}个，算法的预测为${prediction_list[2]}个，预测偏差为<b>${bias_percent_list[2]}%</b>。</p>
                            <p>第4次：预测日期为${date_list[3]}，实际销量是${sale_list[3]}个，算法的预测为${prediction_list[3]}个，预测偏差为<b>${bias_percent_list[3]}%</b>。</p>
                            <p>第5次：预测日期为${date_list[4]}，实际销量是${sale_list[4]}个，算法的预测为${prediction_list[4]}个，预测偏差为<b>${bias_percent_list[4]}%</b>。</p>
                            </br></br>
                            <p style='color:Gray;'>（按任意键查看第二轮5次预测结果）</p>
                            </div>`
        },
        on_finish: function(data) {
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part1',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).predictvalue
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
                console.log(sum)
            }
            data.profit_part1 = sum
        }

    }

    var if_shown_exp_algo_part1_feedback = {
        timeline: [exp_algo_part1_feedback],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_1'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_exp_algo_part1_feedback);


    var exp_no_algo_part1_feedback = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            taskname: 'exp_part1_feedback',
        },
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part1',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                console.log(algo_pre_task_info_per)
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).response.pred_num

                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            // 此次收益为<b>${profit_list[0]}</b>元。(删掉了这次改版)

            return `
                            <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【你未授权 ${algo_info} 为你做第一轮5次的销量预测】</p></br>
                            <p style="font: 1.375rem /* 22/16 */ 微软雅黑; line-height: 1.2em;color:Gray; text-align:center">5次销量预测结果评估如下：</p></br>
                            <div style="font:1.25rem /* 20/16 */ SimSun; line-height: 1em; text-align:center; color:black">
                            <p>第1次：预测日期为${date_list[0]}，实际销量是${sale_list[0]}个，你的预测为${prediction_list[0]}个，预测偏差为<b>${bias_percent_list[0]}%</b>。</p>
                            <p>第2次：预测日期为${date_list[1]}，实际销量是${sale_list[1]}个，你的预测为${prediction_list[1]}个，预测偏差为<b>${bias_percent_list[1]}%</b>。</p>
                            <p>第3次：预测日期为${date_list[2]}，实际销量是${sale_list[2]}个，你的预测为${prediction_list[2]}个，预测偏差为<b>${bias_percent_list[2]}%</b>。</p>
                            <p>第4次：预测日期为${date_list[3]}，实际销量是${sale_list[3]}个，你的预测为${prediction_list[3]}个，预测偏差为<b>${bias_percent_list[3]}%</b>。</p>
                            <p>第5次：预测日期为${date_list[4]}，实际销量是${sale_list[4]}个，你的预测为${prediction_list[4]}个，预测偏差为<b>${bias_percent_list[4]}%</b>。</p>
                            </br></br>
                            <p style='color:Gray;'>（按任意键查看第二轮5次预测结果）</p>
                            </div>`
        },
        on_finish: function(data) {
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part1',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                console.log(algo_pre_task_info_per)
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).response.pred_num
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
            }
            data.profit_part1 = sum
        }

    }

    var if_shown_exp_no_algo_part1_feedback = {
        timeline: [exp_no_algo_part1_feedback],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_1'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_exp_no_algo_part1_feedback)


    //******************************第二次5轮预测结果反馈************************************
    var exp_algo_part2_feedback = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            taskname: 'exp_part2_feedback',
        },
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part2',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).predictvalue
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            console.log(profit_list)
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
                console.log(sum)
            }
            console.log(sum)
                //average = Math.floor(average * 100) / 100
                //，此次收益为<b>${profit_list[0]}</b>元。(删掉了这次改版)

            return `
                            <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【你已授权 ${algo_info} 为你做第二轮5次的销量预测】</p></br>
                            <p style="font: 1.375rem /* 22/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">5次销量预测结果评估如下：</p></br>
                            <div style="font:1.25rem /* 20/16 */ SimSun; line-height: 1em; text-align:center; color:black">
                            <p>第1次：预测日期为${date_list[0]}，实际销量是${sale_list[0]}个，算法的预测为${prediction_list[0]}个，预测偏差为<b>${bias_percent_list[0]}%</b>。</p>
                            <p>第2次：预测日期为${date_list[1]}，实际销量是${sale_list[1]}个，算法的预测为${prediction_list[1]}个，预测偏差为<b>${bias_percent_list[1]}%</b>。</p>
                            <p>第3次：预测日期为${date_list[2]}，实际销量是${sale_list[2]}个，算法的预测为${prediction_list[2]}个，预测偏差为<b>${bias_percent_list[2]}%</b>。</p>
                            <p>第4次：预测日期为${date_list[3]}，实际销量是${sale_list[3]}个，算法的预测为${prediction_list[3]}个，预测偏差为<b>${bias_percent_list[3]}%</b>。</p>
                            <p>第5次：预测日期为${date_list[4]}，实际销量是${sale_list[4]}个，算法的预测为${prediction_list[4]}个，预测偏差为<b>${bias_percent_list[4]}%</b>。</p>
                            </br></br>
                            <p style='color:Gray;'>（按任意键查看第三轮5次预测结果）</p>
                            </div>`
        },
        on_finish: function(data) {
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part2',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).predictvalue
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
                console.log(sum)
            }
            data.profit_part2 = sum
        }

    }

    var if_shown_exp_algo_part2_feedback = {
        timeline: [exp_algo_part2_feedback],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_2'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_exp_algo_part2_feedback);


    var exp_no_algo_part2_feedback = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            taskname: 'exp_part2_feedback',
        },
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part2',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                console.log(algo_pre_task_info_per)
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).response.pred_num

                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            // 此次收益为<b>${profit_list[0]}</b>元。(删掉了这次改版)

            return `
                            <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【你未授权 ${algo_info} 为你做第二轮5次的销量预测】</p></br>
                            <p style="font: 1.375rem /* 22/16 */ 微软雅黑; line-height: 1.2em;color:Gray; text-align:center">5次销量预测结果评估如下：</p></br>
                            <div style="font:1.25rem /* 20/16 */ SimSun; line-height: 1em; text-align:center; color:black">
                            <p>第1次：预测日期为${date_list[0]}，实际销量是${sale_list[0]}个，你的预测为${prediction_list[0]}个，预测偏差为<b>${bias_percent_list[0]}%</b>。</p>
                            <p>第2次：预测日期为${date_list[1]}，实际销量是${sale_list[1]}个，你的预测为${prediction_list[1]}个，预测偏差为<b>${bias_percent_list[1]}%</b>。</p>
                            <p>第3次：预测日期为${date_list[2]}，实际销量是${sale_list[2]}个，你的预测为${prediction_list[2]}个，预测偏差为<b>${bias_percent_list[2]}%</b>。</p>
                            <p>第4次：预测日期为${date_list[3]}，实际销量是${sale_list[3]}个，你的预测为${prediction_list[3]}个，预测偏差为<b>${bias_percent_list[3]}%</b>。</p>
                            <p>第5次：预测日期为${date_list[4]}，实际销量是${sale_list[4]}个，你的预测为${prediction_list[4]}个，预测偏差为<b>${bias_percent_list[4]}%</b>。</p>
                            </br></br>
                            <p style='color:Gray;'>（按任意键查看第三轮5次预测结果）</p>
                            </div>`
        },
        on_finish: function(data) {
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part2',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                console.log(algo_pre_task_info_per)
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).response.pred_num
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
            }
            data.profit_part2 = sum
        }

    }

    var if_shown_exp_no_algo_part2_feedback = {
        timeline: [exp_no_algo_part2_feedback],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_2'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_exp_no_algo_part2_feedback)


    //******************************第三次5轮预测结果反馈************************************
    var exp_algo_part3_feedback = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            taskname: 'exp_part3_feedback',
        },
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part3',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).predictvalue
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            console.log(profit_list)
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
                console.log(sum)
            }
            console.log(sum)
                //average = Math.floor(average * 100) / 100
                //，此次收益为<b>${profit_list[0]}</b>元。(删掉了这次改版)

            return `
                            <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【你已授权 ${algo_info} 为你做第三轮5次的销量预测】</p></br>
                            <p style="font: 1.375rem /* 22/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">5次销量预测结果评估如下：</p></br>
                            <div style="font:1.25rem /* 20/16 */ SimSun; line-height: 1em; text-align:center; color:black">
                            <p>第1次：预测日期为${date_list[0]}，实际销量是${sale_list[0]}个，算法的预测为${prediction_list[0]}个，预测偏差为<b>${bias_percent_list[0]}%</b>。</p>
                            <p>第2次：预测日期为${date_list[1]}，实际销量是${sale_list[1]}个，算法的预测为${prediction_list[1]}个，预测偏差为<b>${bias_percent_list[1]}%</b>。</p>
                            <p>第3次：预测日期为${date_list[2]}，实际销量是${sale_list[2]}个，算法的预测为${prediction_list[2]}个，预测偏差为<b>${bias_percent_list[2]}%</b>。</p>
                            <p>第4次：预测日期为${date_list[3]}，实际销量是${sale_list[3]}个，算法的预测为${prediction_list[3]}个，预测偏差为<b>${bias_percent_list[3]}%</b>。</p>
                            <p>第5次：预测日期为${date_list[4]}，实际销量是${sale_list[4]}个，算法的预测为${prediction_list[4]}个，预测偏差为<b>${bias_percent_list[4]}%</b>。</p>
                            </br></br>
                            <p style='color:Gray;'>（按任意键进入下一环节）</p>
                            </div>`
        },
        on_finish: function(data) {
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part3',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).predictvalue
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
                console.log(sum)
            }
            data.profit_part3 = sum
        }

    }

    var if_shown_exp_algo_part3_feedback = {
        timeline: [exp_algo_part3_feedback],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_3'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '购买并使用算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_exp_algo_part3_feedback);


    var exp_no_algo_part3_feedback = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            taskname: 'exp_part3_feedback',
        },
        stimulus: function() {
            var team_intro_info = jsPsych.data.get().filter({
                task: 'AIAD_manip'
            }).values()[0]
            var algo_info = eval(JSON.parse(JSON.stringify(team_intro_info))).AIAD_info
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part3',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                console.log(algo_pre_task_info_per)
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).response.pred_num

                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            // 此次收益为<b>${profit_list[0]}</b>元。(删掉了这次改版)

            return `
                            <p style="font: 1.5rem /* 24/16 */ 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【你未授权 ${algo_info} 为你做第三轮5次的销量预测】</p></br>
                            <p style="font: 1.375rem /* 22/16 */ 微软雅黑; line-height: 1.2em;color:Gray; text-align:center">5次销量预测结果评估如下：</p></br>
                            <div style="font:1.25rem /* 20/16 */ SimSun; line-height: 1em; text-align:center; color:black">
                            <p>第1次：预测日期为${date_list[0]}，实际销量是${sale_list[0]}个，你的预测为${prediction_list[0]}个，预测偏差为<b>${bias_percent_list[0]}%</b>。</p>
                            <p>第2次：预测日期为${date_list[1]}，实际销量是${sale_list[1]}个，你的预测为${prediction_list[1]}个，预测偏差为<b>${bias_percent_list[1]}%</b>。</p>
                            <p>第3次：预测日期为${date_list[2]}，实际销量是${sale_list[2]}个，你的预测为${prediction_list[2]}个，预测偏差为<b>${bias_percent_list[2]}%</b>。</p>
                            <p>第4次：预测日期为${date_list[3]}，实际销量是${sale_list[3]}个，你的预测为${prediction_list[3]}个，预测偏差为<b>${bias_percent_list[3]}%</b>。</p>
                            <p>第5次：预测日期为${date_list[4]}，实际销量是${sale_list[4]}个，你的预测为${prediction_list[4]}个，预测偏差为<b>${bias_percent_list[4]}%</b>。</p>
                            </br></br>
                            <p style='color:Gray;'>（按任意键进入下一环节）</p>
                            </div>`
        },
        on_finish: function(data) {
            var algo_pre_task_info = jsPsych.data.get().filter({
                    phase: 'exp_delegation_part3',
                    task: 'exp_detail_info',
                }).values()
                //var info = eval(JSON.parse(JSON.stringify(algo_pre_task_info))).turevalue
                //console.log(info)
            var date_list = []
            var sale_list = []
            var prediction_list = []
            var bias_percent_list = []
            var profit_list = []
            for (var i = 0; i < 5; i++) {
                var algo_pre_task_info_per = algo_pre_task_info[i]
                console.log(algo_pre_task_info_per)
                var date = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).taskdate
                var sale = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).turevalue
                var prediction = eval(JSON.parse(JSON.stringify(algo_pre_task_info_per))).response.pred_num
                var bias = (Math.abs(prediction - sale)) / sale
                if (bias == 0) {
                    var daily_profit = 5
                } else if (0.00 < bias <= 0.08) {
                    var daily_profit = 4
                } else if (0.08 < bias <= 0.16) {
                    var daily_profit = 3
                } else if (0.16 < bias <= 0.24) {
                    var daily_profit = 2
                } else if (0.24 < bias <= 0.32) {
                    var daily_profit = 1
                } else {
                    var daily_profit = 0
                }
                var bias_percent = bias * 100
                var bias_percent = bias_percent.toFixed(2)
                date_list.push(date)
                sale_list.push(sale)
                prediction_list.push(prediction)
                bias_percent_list.push(bias_percent)
                profit_list.push(daily_profit)
            }
            var sum = 0
            for (var j = 0; j < 5; j++) {
                sum = profit_list[j] + sum;
            }
            data.profit_part3 = sum
        }

    }

    var if_shown_exp_no_algo_part3_feedback = {
        timeline: [exp_no_algo_part3_feedback],
        conditional_function: function() {
            var delegated = jsPsych.data.get().filter({
                task: 'delegate_decision_3'
            }).values()[0]
            var delegated = JSON.stringify(delegated)
            var delegated = eval(JSON.parse(delegated)).response.P0_Q2
            if (jsPsych.pluginAPI.compareKeys(delegated, '不购买算法')) {
                return true;
            } else {
                return false;
            }
        }
    };
    //timeline.push(if_shown_exp_no_algo_part3_feedback)


    //***************************************************问卷填写*******************************************
    var scale = ["完全没有信心", "没有信心", "有点没有信心", "不确定", "有点信心", "有信心", "非常有信心"];

    var key_factors_survey_4 = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">【预测任务结束的问卷填写】</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p>接下来你将进入有关预测任务的问卷填写阶段。请根据目前你得到的信息和感受认真填写！</p>
        </div>
        <p>`,
            button_lable: '填写问卷',
            delay_after: 100
        }
        //timeline.push(key_factors_survey_4)


    var variables_measurement_part4 = {
            type: jsPsychSurvey,
            data: {
                phasename: 'exp4_survey',
            },
            pages: [
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 1/5 】</p>`,
                }, {
                    type: 'text',
                    prompt: '请问你对当前这个算法有什么想法或者感受？(10-200字之内)',
                    textbox_rows: 3,
                    name: 'feeling_about_algo',
                    required: true
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 2/5 】</p>`,
                }, {
                    type: 'html',
                    prompt: `<p style="font: 1.25rem 微软雅黑; line-height: 0.1em;text-align:left;font-weight:550">你在多大程度上同意以下说法：</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 这份预测工作的难度是大的。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Difficulty',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 这个公司的算法开发能力高。（请你选择4）',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Attention_check_3',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 到目前为止，我对自己的预测表现是满意的。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Performance_eval',
                    likert_scale_values: likert_scale,
                    required: true,
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 3/5 】</p>`,
                }, {
                    type: 'ranking',
                    prompt: '· 你认为蛋糕预测任务中7个预测信息的重要性排序是怎样的？(上下拖动选项进行排序）',
                    name: 'Self_reasoning',
                    options: ['日期', '星期几', '温度', '宣传单数量', '是否促销', '前一周平均每天人流量', '天气'],
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 该AI预测算法对7个因素的重要性排序和你自己的排序一致。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Reasoning_consistency',
                    likert_scale_values: likert_scale,
                    required: true,
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 4/5 】</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 我现在相信此算法可以预测出准确的蛋糕销量。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Trust2',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我会在之后的预测任务中使用该AI预测算法。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Usage_willingness_part2',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我会向别的烘焙店店主推荐这个AI预测算法。',
                    likert_scale_min_label: '完全不同意',
                    likert_scale_max_label: '完全同意',
                    name: 'Recommendation',
                    likert_scale_values: likert_scale,
                    required: true,
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 5/5 】</p>`,
                }, {
                    type: 'multi-select',
                    prompt: '· 关于本实验中提到的算法，以下哪些说法是正确的？',
                    options: ["这个算法是基于AI实现的预测算法", "这个算法开发过程中全部是专业人士", "这个算法的预测正确率是100%", "这个算法到目前为止都是免费使用的"],
                    name: 'attention_check_4',
                    required: true,
                }, {
                    type: 'multi-select',
                    prompt: '·  根据现在提供的算法信息，算法开发过程中涉及到哪些人？',
                    options: ["没有介绍包括哪些人", "AI算法工程师", "蛋糕消费者", "烘焙店店主", "AIplus公司销售人员"],
                    name: 'attention_check_5',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 你认为算法5元预测5次的定价如何？',
                    likert_scale_min_label: '非常便宜',
                    likert_scale_max_label: '非常贵',
                    name: 'price_perception',
                    likert_scale_values: likert_scale,
                    required: true,
                }]
            ],
            button_label_back: '上一页',
            button_label_next: '下一页',
            button_label_finish: '继续实验'
        }
        //timeline.push(variables_measurement_part2)


    var key_factors_survey_5 = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">【最后一阶段问卷填写】</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p>接下来你将进入<b>最后一阶段</b>的问卷填写，也是本实验的最后一个环节。</p>
        <p><font color='red'>完成本环节的问卷填写，你将会查看到自己的最终收益！</font>本实验的报酬有机会高达50元！</p>
        </div>
        <p>`,
            button_lable: '填写问卷',
            delay_after: 100
        }
        //timeline.push(key_factors_survey_5)

    var variables_measurement_part5_PDB = {
            type: jsPsychSurveyLikert,
            data: {
                phasename: 'exp_survey_5',
            },
            preamble: `
            <p style="font: 10pt 微软雅黑; line-height: 1 em;color:Gray; text-align:center">【 4/8 】</p>
            <p style="font: 1.25rem 微软雅黑; line-height: 0.1em; text-align:left">请回答对以下观点的赞成程度:</p>
            `,
            questions: [{
                prompt: "组织中较低层次的人应该毫无疑义地执行较高层次的人的要求。",
                name: 'Self_PDB_1',
                labels: ['完全不同意', '不同意', '有点不同意', '不确定', '有点同意', '同意', '非常同意'],
                required: true,
            }, {
                prompt: "一个高效率的组织需要明确谁是领导者谁是追随者。",
                name: 'Self_PDB_2',
                labels: ['完全不同意', '不同意', '有点不同意', '不确定', '有点同意', '同意', '非常同意'],
                required: true,
            }, {
                prompt: "当追随者全心全意地信任他们的领导者时，这个团队更有机会取得最大的成功。",
                name: 'Self_PDB_3',
                labels: ['完全不同意', '不同意', '有点不同意', '不确定', '有点同意', '同意', '非常同意'],
                required: true,
            }, {
                prompt: "组织中的低层级人员在组织中不应该有太大的权力。",
                name: 'Self_PDB_4',
                labels: ['完全不同意', '不同意', '有点不同意', '不确定', '有点同意', '同意', '非常同意'],
                required: true,
            }],
            button_label: '继续'
        }
        //timeline.push(variables_measurement_part3_PDB);

    var likert_scale_3 = [{
        value: 1,
        text: '错误'
    }, {
        value: 2,
        text: '不清楚'
    }, {
        value: 3,
        text: '正确'
    }]

    var variables_measurement_part5_literacy = {
            type: jsPsychSurvey,
            data: {
                phasename: 'exp_survey_5',
            },
            pages: [
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 5/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: '算法的应用十分广泛。接下来你将看到关于算法的一些陈述，请判断是否正确。',
                }, {
                    type: 'likert',
                    prompt: '· 算法所使用的数据库不能成为影响算法质量的决定性因素之一。',
                    name: 'Algo_literacy_1',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 我可以通过自己的使用行为影响算法。',
                    name: 'Algo_literacy_2',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 在有的应用场景下，算法给出的建议可能随着用户不同而不同。',
                    name: 'Algo_literacy_3',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 当使用个性化算法时，算法推荐的内容是和你之前的偏好一致的。',
                    name: 'Algo_literacy_4',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 6/8 】</p>`,
                }, {
                    type: 'likert',
                    prompt: '· 算法可以像人类一样思考。',
                    name: 'Algo_literacy_5',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 算法不受政府审查机制的影响。',
                    name: 'Algo_literacy_6',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 算法带来的机会与风险并存。',
                    name: 'Algo_literacy_7',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 一些公司或者组织发布的定期重复的内容是已经由算法写好的了。',
                    name: 'Algo_literacy_8',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 在使用算法时，人类从未参与其中。',
                    name: 'Algo_literacy_9',
                    likert_scale_values: likert_scale_3,
                    required: true,
                }],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 7/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: '请你根据自己的经历回答以下问题。',
                }, {
                    type: 'likert',
                    prompt: '· 你对AI或者智能决策算法熟悉吗？例如ChatGPT',
                    likert_scale_min_label: '完全不熟悉',
                    likert_scale_max_label: '非常熟悉',
                    name: 'fimilarity',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'ranking',
                    prompt: '· 你对AI哪些方面的表现抱有很大的期望？(上下拖动选项进行排序）',
                    name: 'expetancy_ranking',
                    options: ['准确性', '效率', '透明性', '问责性', '公平性', '共情性'],
                    required: true,
                }, {
                    type: 'ranking',
                    prompt: '· 你认为自己为什么会对AI表现产生一定的期望？(上下拖动选项进行排序）',
                    name: 'expetancy_reasoning',
                    options: ['自己之前使用AI的经验', '媒体对于AI的宣传与报道', '社会和大众对AI的态度', '学习了AI的专业知识'],
                    required: true,
                }, ],
                [{
                    type: 'html',
                    prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 8/8 】</p>`,
                }, {
                    type: 'html',
                    prompt: '参与社交媒体互动的自动化程序也叫作社交机器人（bot），请根据您使用社交媒体的经验回答以下问题。',
                }, {
                    type: 'multi-choice',
                    prompt: "你认为自己常用的社交媒体上bot用户占全部用户的比例是多少？（例如，微博）",
                    options: ['0-20%', '20%-40%', '40%-60%', '60%-80%', '80%-100%'],
                    name: 'bot_percent',
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 你看到的或者接触到的机器人账户多吗？',
                    likert_scale_min_label: '非常少',
                    likert_scale_max_label: '非常多',
                    name: 'bot_touch_amout',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 同一事件，智能机器人的言论和意见会影响甚至改变你原来的判断吗？',
                    likert_scale_min_label: '完全不会',
                    likert_scale_max_label: '完全会',
                    name: 'bot_advice_impact',
                    likert_scale_values: likert_scale,
                    required: true,
                }, {
                    type: 'likert',
                    prompt: '· 同一事件，智能机器人的意见和人类的意见，哪个对你观点的形成影响大一点？（越接近7，意味着bot的影响越大）',
                    likert_scale_min_label: '人类的意见',
                    likert_scale_max_label: '智能机器人的意见',
                    name: 'bot_vs_human',
                    likert_scale_values: likert_scale,
                    required: true,
                }, ]

            ],
            button_label_back: '上一页',
            button_label_next: '下一页',
            button_label_finish: '结束填写问卷'
        }
        //timeline.push(variables_measurement_part3_literacy);


    var basic_info_survey = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
        <p style="font: 20pt 微软雅黑; line-height: 1.5em; text-align:center">【基本信息填写】</p></br>
        <div style="font:20pt SimSun; line-height: 1em; text-align:center">
        <p>在正式进入实验之前，你首先需要填写个人基本信息，并回答相关问项。</p>
        <p>你的信息我们将完全保密。</p>
        <p>填写结果影响到你之后的实验报酬，因此请认真填写！</p>
        </div>
        <p>`,
            button_lable: '填写个人信息',
            delay_after: 100
        }
        //timeline.push(basic_info_survey)

    var basic_info = {
            type: jsPsychSurveyHtmlForm,
            preamble: `
                    <p style="font: 1.5rem 微软雅黑; text-align: left; line-height: 1.5em;color:Gray; ">最后，请如实填写以下信息。</p>
            `,
            html: '<div style="font: 1.1875rem SimSun; text-align: left; line-height: 1.5em; font-weight:bold"> <p> 1. 你的性别：<input type="text" id="test-resp-box" name="response1" size="20" required/></p></br> <p> 2. 你的年龄：<input type="text" id="test-resp-box" name="response2" size="20" required/></p></br> <p> 3. 你所学的专业：<input type="text" id="test-resp-box" name="response3" size="20" required/></p></br></div>',
            autofocus: 'test-resp-box',
            button_label: '下一页',
            data: {
                phasename: 'basic_info',
            }
        }
        //timeline.push(basic_info)

    var basic_info_efficacy = {
        type: jsPsychSurvey,
        data: {
            phasename: 'exp_survey_5',
        },
        pages: [
            [{
                type: 'html',
                prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 1/8 】</p>`,
            }, {
                type: 'html',
                prompt: '请判断下列陈述是否符合你的情况。',
            }, {
                type: 'likert',
                prompt: '· 我相信自己可以有效地处理突发事件',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'self_efficacy1',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 由于我的足智多谋，我知道如何处理不可预见的情况',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'self_efficacy2',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 如果我投入必要的努力，我可以解决大多数问题',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'self_efficacy3',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 我可以在面对困难时保持冷静，因为我相信自己的应对能力',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'self_efficacy4',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 我通常可以处理遇到的任何事情',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'self_efficacy5',
                likert_scale_values: likert_scale,
                required: true,
            }],
            [{
                type: 'html',
                prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 2/8 】</p>`,
            }, {
                type: 'html',
                prompt: '请判断下列陈述是否符合你的情况。',
            }, {
                type: 'likert',
                prompt: '· 我更喜欢可以很大程度上控制自己工作内容和时间的工作',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'desire_for_control_1',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 我更愿意成为领导者而不是追随者',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'desire_for_control_2',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 我喜欢自己做决定',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'desire_for_control_3',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 我喜欢自己控制自己的命运',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'desire_for_control_4',
                likert_scale_values: likert_scale,
                required: true,
            }, {
                type: 'likert',
                prompt: '· 我尽量避免别人来告诉我我应该做什么',
                likert_scale_min_label: '完全不符合',
                likert_scale_max_label: '完全符合',
                name: 'desire_for_control_5',
                likert_scale_values: likert_scale,
                required: true,
            }, ],
            [{
                type: 'html',
                prompt: `<p style="font: 10pt 微软雅黑; line-height: 0.1em;color:Gray; text-align:center">【 3/8 】</p>`,
            }, {
                type: 'likert-table',
                prompt: '在一项游戏中，收益结果是根据抛硬币的结果决定的，请仔细阅读收益规则并决定是否接受游戏挑战。',
                statements: [{
                    prompt: '# 1.如果硬币正面朝上，你会失去20元；如果硬币背面朝上，你会获得60元。',
                    name: 'loss_aversion_1'
                }, {
                    prompt: '# 2.如果硬币正面朝上，你会失去30元；如果硬币背面朝上，你会获得60元。',
                    name: 'loss_aversion_2'
                }, {
                    prompt: '# 3.如果硬币正面朝上，你会失去40元；如果硬币背面朝上，你会获得60元。',
                    name: 'loss_aversion_3'
                }, {
                    prompt: '# 4.如果硬币正面朝上，你会失去50元；如果硬币背面朝上，你会获得60元。',
                    name: 'loss_aversion_4'
                }, {
                    prompt: '# 5.如果硬币正面朝上，你会失去60元；如果硬币背面朝上，你会获得60元。',
                    name: 'loss_aversion_5'
                }, {
                    prompt: '# 6.如果硬币正面朝上，你会失去70元；如果硬币背面朝上，你会获得60元。',
                    name: 'loss_aversion_6'
                }],
                options: ['接受', '拒绝'],
                required: true
            }]
        ],
        button_label_back: '上一页',
        button_label_next: '下一页',
        button_label_finish: '下一页'
    };
    //timeline.push(basic_info_efficacy);

    var exp_game_end = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            message: `
                    <p style="font: 20pt 微软雅黑; text-align: center; line-height: 1.6em">
                    <b>
                        实验到这里已经完全结束。感谢你的参与！<br/><br/>
                        请点击按钮查看你的实验收益。<br/><br/>
			            为了保证你的实验数据可以有效保存，请你在<font color='red'>点击按钮之后不要有任何操作，并联系实验人员</font>。
                        </b> </br></br></br>
                    `,
            button_label: '查看实验收益',
            delay_after: 100
        }
        //timeline.push(exp_game_end);

    var exp_end_pay = {
        type: jsPsychHtmlKeyboardResponse,
        data: {
            phasename: 'payment',
        },
        stimulus: function() {
            //实验环节1

            var part1_feedback = jsPsych.data.get().filter({
                taskname: 'exp_part1_feedback'
            }).values()[0]
            var part1_profit = eval(JSON.parse(JSON.stringify(part1_feedback))).profit_part1

            if (part1_profit < 0) {
                part1_profit = 0
            } else {
                part1_profit = part1_profit
            }

            var part2_feedback = jsPsych.data.get().filter({
                taskname: 'exp_part2_feedback'
            }).values()[0]
            var part2_profit = eval(JSON.parse(JSON.stringify(part2_feedback))).profit_part2

            if (part2_profit < 0) {
                part2_profit = 0
            } else {
                part2_profit = part2_profit
            }

            var part3_feedback = jsPsych.data.get().filter({
                taskname: 'exp_part3_feedback'
            }).values()[0]
            var part3_profit = eval(JSON.parse(JSON.stringify(part3_feedback))).profit_part3

            if (part3_profit < 0) {
                part3_profit = 0
            } else {
                part3_profit = part3_profit
            }


            //购买算法次数
            var purchase_info = jsPsych.data.get().filter({
                task: "delegate_decision_1"
            }).values()[0]
            var purchase1 = eval(JSON.parse(JSON.stringify(purchase_info))).response.P0_Q2
            console.log(purchase1)
            if (purchase1 == '购买并使用算法') {
                purchase_1 = 1
            } else {
                purchase_1 = 0
            }
            console.log(purchase_1)

            var purchase_info2 = jsPsych.data.get().filter({
                task: "delegate_decision_2"
            }).values()[0]
            console.log(purchase_info2)
            var purchase2 = eval(JSON.parse(JSON.stringify(purchase_info2))).response.P0_Q2
            console.log(purchase2)
            if (purchase2 == '购买并使用算法') {
                purchase_2 = 1
            } else {
                purchase_2 = 0
            }
            console.log(purchase_2)

            var purchase_info3 = jsPsych.data.get().filter({
                task: "delegate_decision_3"
            }).values()[0]
            console.log(purchase_info3)
            var purchase3 = eval(JSON.parse(JSON.stringify(purchase_info3))).response.P0_Q2
            console.log(purchase3)
            if (purchase3 == '购买并使用算法') {
                purchase_3 = 1
            } else {
                purchase_3 = 0
            }
            console.log(purchase_3)

            purchase_time = purchase_1 + purchase_2 + purchase_3

            var cost = purchase_time * 5
            var select_all_profit = 15.0 + part1_profit + part2_profit + part3_profit - cost
            var select_all_profit = Math.floor(select_all_profit * 100) / 100
            return `
                            <p style="font: 20pt 微软雅黑; line-height: 1.5em;color:Gray; text-align:center">【实验酬金】</p></br>
                            <div style="font:20pt SimSun; line-height: 1.2em; text-align:center; color:black">
                            <p>1. 基本酬金：<b>15</b> 元</p>
                            <p>2. 第一轮5次预测：浮动酬金（5次总收益）为<b>${part1_profit}</b>元</p>
                            <p>2. 第二轮5次预测：浮动酬金（5次总收益）为<b>${part2_profit}</b>元</p>
                            <p>2. 第三轮5次预测：浮动酬金（5次总收益）为<b>${part3_profit}</b>元</p>
                            <p>4. 算法购买：购买算法<b>${purchase_time}</b>次，购买成本<b>${cost}</b>元</p>
                            <p> 你的总收益为<font color='red'><b>${select_all_profit}</b></font>元</p></br>
                            <p> 请不要继续操作，并及时联系实验人员~</p></br>
                            </div>`
        }
    }

    var exp_intro = {
        timeline: [exp_open_remarks, exp_game_task_intro, exp_interest_intro, exp_interest_test, exp_rule_intro]
    }

    var practice_3 = {
        timeline: [practice_trial_intro, exp_pre_pract3, exp_pre_pract3_end]
    }

    var self_prediction_7 = {
        timeline: [self_pre_trial_intro, self_pre_7, self_pre_7_end]
    }

    var manipulation = {
        timeline: [exp_manipu_phase1_intro, exp_manipu_interest_intro, exp_manipu_algo_intro_1, exp_manipu_algo_intro_2, exp_algorithm_web_0_show,
            exp_algorithm_web_1_show, exp_algorithm_web_2_show, manipulation_check
        ]
    }

    var pre5_delegation_1 = {
        timeline: [exp_algo_delegation_1, if_shown_algo_delegation_yes_1_intro, if_shown_algo_delegation_no_1_intro, exp_delegation_part1, key_factors_survey_1,
            variables_measurement, exp_manipu_phase1_end
        ]
    }


    var pre5_delegation_2 = {
        timeline: [exp_algo_delegation_2_intro, exp_algo_delegation_2, if_shown_algo_delegation_yes_2_intro,
            if_shown_algo_delegation_no_2_intro, exp_delegation_part2, key_factors_survey_2, variables_measurement_2, exp_manipu_phase2_end
        ]
    }

    var pre5_delegation_3 = {
        timeline: [exp_algo_delegation_3_intro, exp_algo_delegation_3, if_shown_algo_delegation_yes_3_intro,
            if_shown_algo_delegation_no_3_intro, exp_delegation_part3, key_factors_survey_3, variables_measurement_3
        ]
    }

    var pre15_feedback = {
        timeline: [
            exp_feedback15_intro, if_shown_exp_algo_part1_feedback, if_shown_exp_no_algo_part1_feedback, if_shown_exp_algo_part2_feedback,
            if_shown_exp_no_algo_part2_feedback, if_shown_exp_algo_part3_feedback, if_shown_exp_no_algo_part3_feedback
        ]
    }

    var survey = {
        timeline: [key_factors_survey_4, variables_measurement_part4, key_factors_survey_5,
            basic_info_efficacy, variables_measurement_part5_PDB, variables_measurement_part5_literacy, basic_info
        ]
    }

    var end = {
        timeline: [exp_game_end, exp_end_pay]
    }
    var global_var = {
        timeline: [set_html_style, preload]
    }

    var timeline = [
        global_var,
        exp_intro,
        practice_3,
        self_prediction_7,
        manipulation,
        pre5_delegation_1,
        pre5_delegation_2,
        pre5_delegation_3,
        pre15_feedback,
        survey,
        end
    ]

    jsPsych.run(timeline);
</script>

</html>